<html devsite><head>
  <title>Mit Malware gehackt</title>
  <meta name="project_path" value="/web/fundamentals/_project.yaml"/>
  <meta name="book_path" value="/web/fundamentals/_book.yaml"/>
</head>
  <body>
<p>Dieser Schritt bezieht sich auf Websites, die gehackt wurden, um Malware zu verbreiten. Sie werden in den Suchergebnissen oft mit der Warnung <em>Diese Website kann Ihren Computer beschädigen</em> angezeigt. Dies ist einer der längsten Schritte im Wiederherstellungsprozess.  Im Folgenden erstellen Sie eine Liste der beschädigten Dateien auf Ihrer Website.
  Diese Liste wird später beim Schritt <a href="clean_site">Website bereinigen und instand halten</a> benötigt.</p>
  <p>Falls Ihre Website von Spam betroffen ist und in den Suchergebnissen die Warnung <em>Diese Website wurde möglicherweise gehackt</em> angezeigt wird, sollten Sie sich die Seite <a href="hacked_with_spam">Schaden durch Spam beurteilen</a> ansehen.</p>

    <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="Snt45fZQIiU" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<h3>Sie benötigen Folgendes:</h3>
<ul>
  <li>Shell- bzw. Terminal-Administratorzugriff auf Ihre Website-Server: Web, Datenbank, Dateien</li>
  <li>Kenntnisse der Shell- bzw. Terminal-Befehle</li>
  <li>Die Fähigkeit, SQL-Abfragen in der Datenbank auszuführen</li>
</ul>
<h3>Was Sie tun müssen:</h3>

<div class="action">
<p>Dieser Abschnitt besteht aus drei Schritten:</p>
<ul>
  <li><a href="#preparation">Vorbereitung</a></li>
  <li><a href="#investigation">Untersuchung bestimmter Arten von Malware-Infektion</a></li>
  <li><a href="#assessment">Allgemeine Bewertung des Schadens am Dateisystem</a></li>
</ul>
</div>

<a name="preparation"></a>
<h3>Vorbereitung</h3>
<ol>
  <li>Sie sollten die Seiten Ihrer Website nicht mit einem Browser aufrufen. Malware wird häufig durch Sicherheitslücken in Browsern verbreitet; deshalb könnte Ihr Computer beschädigt werden, falls Sie infizierte Seiten mit einem Browser öffnen.</li>
  <li>Erstellen Sie ein Dokument, um die Ergebnisse in diesem Schritt zu erfassen. Darin sollten Sie mindestens den Namen und Speicherort aller beschädigten Dateien und die Art der Infektion aufzeichnen. Dieses Dokument dient als Grundlage für den Abschnitt <a href="clean_site">Website bereinigen und instand halten</a>.</li>
  <li>Sehen Sie sich je nach Bedarf weitere Ressourcen an:
    <ul>
      <li>In dem Video oben auf dieser Seite wird erklärt, wie Malware funktioniert und wie Sie Ihre Malware-Untersuchung sicher durchführen können.</li>
      <li>Auf der <a href="/safe-browsing/">Diagnostikseite für Google Safe Browsing</a> finden Sie öffentliche Informationen darüber, ob bestimmte Websites als gefährlich für Besucher eingeschätzt werden. Den Status Ihrer Website können Sie unter einer URL ähnlich der folgenden einsehen:
      <pre>http://www.google.com/safebrowsing/diagnostic?site=&lt;your-site&gt;</pre>
      Beispiel:
      <code>http://www.google.com/safebrowsing/diagnostic?site=webmastercentralblog.blogspot.com</code></li>
    </ul>
  </li>
  <li>Verwenden Sie <a href="https://www.google.com/search?q=cURL">cURL</a> oder <a href="https://www.google.com/search?q=Wget">Wget</a>, um HTTP-Anfragen durchzuführen – etwa zum Abrufen einer Seite.
    <p>Diese kostenlos verfügbaren Tools helfen bei der Diagnose von Weiterleitungen und können Informationen zur Verweis-URL oder zum User-Agent beinhalten. Das ist besonders hilfreich, wenn Hacker nachgeahmt werden sollen, da schädliche Inhalte möglicherweise nur an Nutzer mit bestimmten User-Agents oder Verweis-URLs gesendet werden, um mehr "echte Menschen" zu erreichen, und um die Erkennung durch Website-Inhaber und Malware-Scanner zu vermeiden.</p>
    <pre>$curl -v --referer "http://www.google.com" &lt;your-url&gt;</pre></li>
</ol>

<a name="investigation"></a>
<h3>Untersuchung bestimmter Arten von Malware-Infektion auf Ihrer Website</h3>
<ol>
  <li>Wählen Sie Ihre bestätigte Website in der Search Console aus und klicken Sie dann auf <strong>Sicherheitsprobleme</strong>.</li>
  <li> Sehen Sie sich alle Malware-Kategorien wie z. B. "Serverkonfiguration" und "SQL-Einschleusung" an, die unter den Sicherheitsproblemen Ihrer Website aufgelistet sind. Klicken Sie auf "Details anzeigen", um zusätzliche Informationen zu infizierten URLs aus der Kategorie abzurufen. Die Details können vom Hacker eingeschleuste Beispiel-Code-Snippets enthalten. Kopieren Sie für jede Kategorie die folgenden Informationen in Ihr Untersuchungsdokument:
    <ul>
      <li>Alle infizierten Beispiel-URLs, die für die Malware-Kategorie unter "Sicherheitsprobleme" aufgelistet sind</li>
      <li>Zusätzliche beschädigte Seiten, die Sie während Ihrer Untersuchung entdecken</li>
      <li>Detaillierte Ergebnisse über die gehackten URLs – z. B. die Art der entstandenen Schäden</li>
    </ul>
  </li>
  <li>Hilfreiche Informationen für die Untersuchung einer bestimmten Art von Malware finden Sie in folgenden Artikeln:
    <ul>
      <li><a href="https://www.support.google.com/webmasters/answer/3024318">Serverkonfiguration</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024309">SQL-Einschleusung</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024381">Fehlervorlage</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024344">Code-Einschleusung</a></li>
    </ul>
  </li>
</ol>

<a name="assessment"></a>
<h4>Beurteilung des Schadens am Dateisystem</h4>
        <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="2A4dLkXXUjo" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<p>Melden Sie sich nun im Dateisystem Ihrer Website an, um eine genauere Untersuchung durchzuführen. Bedenken Sie, dass der Hacker möglicherweise – unter anderem – die bestehenden Seiten oder Datensätze geändert, völlig neue Spam-Seiten erstellt oder Funktionen geschrieben hat, durch die Spaminhalte auf einer sauberen Seite eingeblendet werden. Er könnte auch Hintertüren eingerichtet haben, um noch einmal auf Ihre Website zuzugreifen oder immer wieder schädliche Aktionen durchzuführen, bis Sie Gegenmaßnahmen ergreifen.</p>
<p>Wenn Ihre Website online ist, können Sie sie für diesen Schritt wieder offline nehmen.</p>
<ol>
  <li>Falls Sie über eine gute Sicherung Ihrer Website verfügen, sollten Sie ermitteln, welche Dateien seit der Sicherung geändert oder erstellt wurden. Fügen Sie diese Dateien auf Ihrer Liste hinzu, da sich eine nähere Untersuchung wahrscheinlich lohnen wird. Auf einem Unix-basierten System können Sie einen Befehl folgender Art ausführen:
  <pre>$ diff -qr &lt;current-directory&gt; &lt;backup-directory&gt;</pre>
  Beispiel:
  <pre>$ diff -qr www/ backups/full-backup-20120124/</pre>
  Auch ein Befehl dieser Art ist möglich:
  <pre>$ md5sum &lt;current-page&gt; &lt;backup-page&gt;</pre>
  Beispiel:
  <pre>$ md5sum www/page.html backups/full-backup-20120124/page.html</pre></li>
  <li>Prüfen Sie die <strong>Server-, Zugriffs- und Fehlerprotokolle</strong> auf verdächtige Aktivitäten. Achten Sie dabei auf fehlgeschlagene Anmeldeversuche, Befehlsverläufe (besonders mit einem Root-Konto), die Einrichtung unbekannter Nutzerkonten und ähnliche Einträge. Es besteht aber die Möglichkeit, dass der Hacker diese Protokolle für die eigenen Zwecke geändert hat. Als zusätzliche Hilfe bietet das Video im Abschnitt <a href="vulnerability">Sicherheitslücken ermitteln</a> ein paar Beispiele.</li>
  <li>Prüfen Sie, ob Weiterleitungen in <strong>Konfigurationsdateien</strong> wie .htaccess und httpd.conf eingefügt wurden.
    Hacker schaffen oft bedingte Umleitungen, die auf der Tageszeit oder der Verweis-URL des User-Agenten basieren.</li>
  <li>Prüfen Sie, ob die Ordner- und Dateiberechtigungen möglicherweise nicht restriktiv genug sind. Hacker manipulieren oftmals Berechtigungen in der Hoffnung, dass sie nicht entdeckt werden und dann nochmals auf die Website zugreifen können. Dateien mit Berechtigungen, die weniger streng als 644 (rw-r--r--) sind, und Ordner mit Berechtigungen, die weniger streng als 755 (rwxr-xr-x) sind, können Sicherheitsprobleme verursachen. Prüfen Sie, ob diese Berechtigungen auch stärker eingeschränkt werden können. Führen Sie auf einem Unix-basierten System testweise die folgenden Befehle durch:
  <pre>$ find &lt;your-dir&gt; -type d -not -perm 755 -exec ls -ld {} \;</pre>
  <pre>$ find &lt;your-dir&gt; -type f -not -perm 644 -exec ls -la {} \;</pre></li>
  <li>Falls Sie eine Datenbank haben, sollten Sie alle Datensätze der Reihe nach mit einem Tool wie <a href="https://www.phpmyadmin.net/home_page/index.php">phpMyAdmin</a> untersuchen.</li>
</ol>

<h2>Nächster Schritt</h2>
<p>Der nächste Schritt im Verfahren ist: <a href="vulnerability">Sicherheitslücken ermitteln</a>.</p>

</body></html>
