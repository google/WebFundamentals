<html devsite><head>
  <title>Устраните все уязвимости и выработайте стратегию защиты сайта</title>
  <meta name="project_path" value="/web/fundamentals/_project.yaml"/>
  <meta name="book_path" value="/web/fundamentals/_book.yaml"/>
</head>
  <body>
<h3>Необходимые условия</h3>

<ul>
  <li>Доступ к серверу сайта (веб-серверу, базе данных и файловой системе) через терминал или оболочку с правами администратора.</li>
  <li>Знание команд оболочки или терминала.</li>
  <li>Понимание кода (например, PHP или JavaScript).</li>
  <li>Свободное пространство для создания резервных копий сайта (включая файлы, базу данных, изображения и т. д.).</li>
</ul>
    <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="OAvydrgDa6Q" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<h3>Дальнейшие действия</h3>

<p>На этом этапе необходимо решить следующие задачи: </p>

<ul>
  <li>Узнать, как правильно действовать, если украдены персональные данные пользователей (например, в результате фишинга).</li>
  <li>Ускорить удаление новых страниц, которые создал хакер, из результатов Google Поиска с помощью функции <a href="https://www.google.com/webmasters/tools/removals">Удалить URL-адреса</a> в Search Console.</li>
  <li>Ускорить индексацию в Google Поиске страниц, которые вы добавили заново или исправили, с помощью <a href="https://www.support.google.com/webmasters/answer/1352276">Сканера Google для сайтов</a> в Search Console.</li>
  <li>Установить последние, самые безопасные версии ПО.</li>
  <li>Удалить лишние и неиспользуемые приложения и плагины, которые со временем делают ваш сайт уязвимее.</li>
  <li>Восстановить ценное содержание и удалить контент, загруженный хакером.</li>
  <li>Устранить уязвимость, которой воспользовался хакер.</li>
  <li>Изменить все пароли.</li>
  <li>Выработать стратегию защиты сайта.</li>
</ul>

<h4>1. Узнайте, как правильно действовать, если украдены персональные данные пользователей (например, в результате фишинга)</h4>

<p>Если хакер смог получить персональные данные пользователей с вашего сайта, подумайте о финансовых и юридических последствиях, а также о санкциях регуляторов, прежде чем приступать к очистке сайта. Если ваш сайт был взломан в целях фишинга, ознакомьтесь с <a href="https://antiphishing.org">этой статьей</a> и другими полезными ресурсами по теме на сайте <a href="https://docs.apwg.org/reports/APWG_WTD_HackedWebsite.pdf">antiphishing.org</a>.</p>

<h4>2. Ускорьте удаление новых страниц, которые создал хакер</h4>

<p>Если хакер создал абсолютно новые страницы, доступные пользователям, вы можете ускорить их удаление из результатов Google Поиска с помощью функции <a href="https://www.google.com/webmasters/tools/removals">Удалить URL-адреса</a> в Search Console. Впрочем, это необязательный шаг. Если вы просто удалите страницы, а затем укажете серверу возвращать <a href="https://www.support.google.com/webmasters/answer/40132">код статуса 404</a>, со временем они пропадут из индекса Google.</p>

<ul>
  <li>Принимая решение, отправлять ли URL для удаления, учитывайте количество новых страниц (тяжело будет запросить удаление сотен URL), а также уровень опасности, которую они представляют для пользователей. Чтобы страницы, URL которых вы отправили, не появлялись в результатах поиска, обязательно настройте для них на сервере код статуса 404 "Файл не найден".</li>
  <li>Не запрашивайте удаление страниц с полезным контентом, которые изменил хакер, – после очистки сайта вы снова захотите видеть их в результатах поиска.
    <em>Запрашивайте удаление только тех URL, которые никогда не должны появляться в результатах поиска.</em></li>
</ul>

<h4>3. Ускорьте индексацию очищенных страниц в Google</h4>

<p>Если вы добавили новые страницы или исправили взломанные, можно ускорить их индексацию в Google Поиске с помощью функции <a href="https://www.support.google.com/webmasters/answer/1352276">Сканера Google для сайтов</a> в Search Console. Этот необязательный шаг, поскольку рано или поздно эти страницы все равно будут проиндексированы.</p>

<h4>4. Начните устранять уязвимости на сервере</h4>

<p>Теперь необходимо устранить последствия взлома на вашем сайте, ориентируясь на записи, которые вы делали во время <a href="hacked_with_spam">анализа ущерба</a> и <a href="vulnerability">поиска уязвимостей</a>. Ваши дальнейшие действия зависят от наличия резервной копии. Возможны три варианта:</p>

<ul>
  <li>У вас есть актуальная резервная копия, созданная до взлома.</li>
  <li>У вас есть созданная до взлома, но устаревшая резервная копия.</li>
  <li>Нет резервной копии.   </li>
</ul>

<p>Сначала убедитесь, что резервная копия была создана <strong>до</strong> взлома сайта.</p>

<ul>
  <li><strong>У вас есть актуальная резервная копия, созданная до взлома</strong>

    <ol>
      <li>Восстановите резервную копию.</li>
      <li>Установите все обновления и исправления безопасности для программного обеспечения. Это касается ОС сервера (если у вас есть к ней доступ) и всех приложений, например системы управления контентом, платформы электронной торговли, плагинов, шаблонов и т. д.</li>
      <li>Удалите программное обеспечение (виджеты, плагины или приложения), которое больше не используется на вашем сайте.</li>
      <li>Устраните уязвимость.</li>
      <li>Убедитесь, что устранены все проблемы, найденные <a href="hacked_with_spam">при оценке масштаба внедрения</a>.</li>
      <li>Ещё раз смените пароли ко всем аккаунтам, связанным с сайтом: например к FTP-серверу, базе данных, операционной системе и системе управления контентом. В Unix-подобных системах используйте эту команду:
        <pre>
$passwd admin1</pre>
      </li>
    </ol>
  </li>
  <li><strong>У вас есть созданная до взлома, но устаревшая резервная копия</strong>
    <ol>
      <li>Создайте образ диска, на котором хранится взломанный сайт. Эта копия будет использоваться лишь для сохранности данных. Обозначьте эту копию как взломанную, чтобы отличить ее от остальных. В Unix-подобных системах образ диска можно создать с помощью этой команды:
        <pre>
$dd if=/dev/sda bs=1024 conv=noerror,sync | gzip -c -9
  &gt; /mirror/full-backup-20120125-infected.gz</pre>
      </li>
      <li>Создайте резервную копию файловой системы сервера, включая изображения и файлы мультимедиа. Если вы используете базу данных, создайте резервную копию и для нее.
        <pre>
$tar -pczf full-backup-20120125-infected.tar.gz www/ $ mysqldump -u root
  -p --all-databases | gzip -9 &gt; fulldb_backup-20120125-infected.sql</pre>
      </li>
      <li>Восстановите чистую, но устаревшую резервную копию на сервер.</li>
      <li>Удалите программное обеспечение (виджеты, плагины или приложения), которое больше не используется на вашем сайте.</li>
      <li>Обновите все программное обеспечение на сервере, включая ОС сервера (если у вас есть к ней доступ) и все приложения, например систему управления контентом, платформу электронной торговли, плагины, шаблоны и т. д. Обязательно проверьте наличие исправлений и обновлений системы безопасности, а затем установите их.</li>
      <li>Устраните уязвимость.</li>
      <li>С помощью команды <code>diff</code> сравните чистую и инфицированную копии сайта вручную или автоматически.
        <pre>
$diff -qr www/ backups/full-backup-20120124/</pre>
      </li>
      <li>Загрузите весь новый и неизмененный хакером контент из инфицированной копии на обновленный сервер.
        <pre>
$rsync -avz /backups/full-backup-20120124/www/clean-file.jpg /www/</pre>
      </li>
      <li>Убедитесь, что устранены все проблемы, найденные на этапе <a href="hacked_with_spam">оценки масштаба внедрения</a>.</li>
      <li>Ещё раз смените пароли ко всем аккаунтам, связанным с сайтом: например, к FTP, базе данных, операционной системе и системе управления контентом. В Unix-подобных системах используйте эту команду:
        <pre>
$passwd admin1</pre>
      </li>
    </ol>
  </li>
  <li><strong>Нет резервной копии</strong>
    <ol>
      <li>Создайте две резервных копии сайта несмотря на то, что он взломан. Дополнительная копия позволит восстановить случайно удаленный контент или начать все заново в случае неудачи. Укажите в их названиях, что это резервные копии взломанного сайта.
        <ul>
          <li>Одна из резервных копий будет образом диска или "клоном сайта". Этот формат значительно упрощает восстановление контента. Оставьте эту резервную копию на непредвиденный случай. В Unix-подобных системах образ диска можно создать с помощью этой команды:
            <pre>
$dd if=/dev/sda bs=1024 conv=noerror,sync | gzip -c -9 &gt;
  /mirror/full-backup-20120125-infected.gz</pre>
          </li>
          <li>Другая копия будет архивом каталога сайта, включая изображения и файлы мультимедиа. Если вы используете базу данных, создайте резервную копию и для нее.
            <pre>
$tar -pczf full-backup-20120125-infected.tar.gz www/</pre>
             

            <pre>
$mysqldump -u root -p --all-databases | gzip -9 &gt; fulldb_backup-20120125-infected.sql</pre>
          </li>
          <li>Если у вас нет доступа к ОС для создания образа диска, создайте по две резервных копии каталога сайта и файловой системы.</li>
        </ul>
      </li>
      <li>Устраните последствия взлома на резервной копии каталога сайта (а не сервера).
        <ol>
          <li>Если раньше вы обнаружили слишком высокий уровень разрешений, исправьте настройки. Пока вносите изменения только в резервную копию, а не на сервере.</li>
          <li>Устраните все следы вмешательства в файлах, которые связаны со взломанными страницами, обнаруженными на этапе <a href="hacked_with_spam">оценки масштаба внедрения</a>. Это могут быть файлы настроек сервера, JavaScript, HTML и PHP.</li>
          <li>Обязательно удалите файлы, созданные хакером, и настройте для соответствующих страниц статус 404. Чтобы ускорить их удаление из индекса Google, можно воспользоваться инструментом "Удалить URL-адреса" в Search Console.</li>
          <li>Устраните уязвимость в коде сайта или замените взломанные пароли. Полезно будет использовать библиотеки проверки вводимых данных и провести аудит безопасности.</li>
          <li>Если на вашем сайте используется база данных, удалите из нее измененные хакером записи.
            Не останавливайтесь на записях из журнала расследования, проверьте базу данных ещё раз, чтобы убедиться в отсутствии подозрительных строк.</li>
          <li>Ещё раз смените пароли ко всем аккаунтам, связанным с сайтом: например, к FTP, базе данных, операционной системе и системе управления контентом. В Unix-подобных системах используйте команду:
            <pre>
$passwd admin1</pre>
          </li>
          <li>Теперь резервная копия ранее взломанного сайта не должна содержать следов хакерского вмешательства. Пора переходить к следующему пункту.</li>
        </ol>
      </li>
    </ol>
  </li>
</ul>

<h4>5. Удалите лишнее программное обеспечение</h4>

<p>Удалите программное обеспечение (виджеты, плагины или приложения), которое больше не используется на вашем сайте. Это повысит безопасность и упростит администрирование в дальнейшем.</p>

<h4>6. Переустановите ОС на серверах</h4>

<ol>
  <li>Переустановите ОС на сервере – не обновляйте ее. При простом обновлении не исключено, что на сервере останутся взломанные файлы, которые позволят злоумышленникам снова захватить над ним контроль.
    <ul>
      <li>Переустановите все программное обеспечение на сервере, включая ОС (если у вас есть к ней доступ) и все приложения, например систему управления контентом, платформу электронной торговли, плагины, шаблоны и т. д. Обязательно проверьте наличие исправлений и обновлений системы безопасности, а затем установите их.</li>
    </ul>
  </li>
  <li>Перенесите полезный контент из очищенной резервной копии на сервер с переустановленной ОС.
    Восстанавливайте файлы и базу данных, только если уверены в том, что они не содержат вредоносный контент или спам. Обязательно отрегулируйте уровень доступа к файлам и следите за тем, чтобы не переписать системные файлы свежеустановленной ОС.</li>
  <li>В последний раз смените пароли ко всем аккаунтам, связанным с сайтом: например, к FTP, базе данных, операционной системе и системе управления контентом. В Unix-подобных системах используйте эту команду:
    <pre>
$passwd admin1</pre>
  </li>
</ol>

<h4>7. Выработайте долгосрочную стратегию защиты сайта</h4>

<p>В Интернете опубликовано множество полезных рекомендаций по защите сайтов от взлома, например <a href="https://www.stopbadware.org/prevent-badware-basics">базовые рекомендации</a> от StopBadware. Вот минимально необходимый набор действий:</p>

<ul>
  <li>Настройте автоматическое резервное копирование сайта по расписанию.</li>
  <li>Регулярно обновляйте программное обеспечение.</li>
  <li>Прежде чем устанавливать какие-либо приложения, плагины и ПО сторонних разработчиков на свой сайт, узнайте, насколько они устойчивы ко взлому. Помните, что уровень защиты всего сайта зависит от надежности каждого из них.</li>
  <li>Сделайте обязательным использование сложных паролей.</li>
  <li>Следите за безопасностью на всех устройствах, с которых вы управляете сайтом: используйте последнюю версию ОС и браузера.</li>
</ul>

<h4>8. Ещё раз проверьте, завершена ли очистка сайта</h4>

<p>Если вы можете ответить "да" на перечисленные ниже вопросы, значит очистка завершена.</p>

<ul>
  <li>Предприняты ли необходимые меры на случай, если хакер завладел персональными данными пользователей? </li>
  <li>Используются ли на моем сайте самые последние версии ПО? </li>
  <li>Удалены ли все неиспользуемые приложения или плагины, которые могли сделать мой сайт уязвимее со временем? </li>
  <li>Восстановлено ли полезное содержание и удален ли добавленный хакером контент? </li>
  <li>Устранена ли уязвимость, которая позволила взломать мой сайт? </li>
  <li>Есть ли у меня стратегия защиты сайта и следую ли я ей?</li>
</ul>

<h4>9. Возобновите работу сайта в Интернете</h4>
<h2>Следующий этап</h2>
<p>Почти готово! Теперь <a href="request_review">запросите проверку</a>.</p>

</body></html>
