---
title: "Как сделать относительными ссылки внутри сайта"
description: "Теперь, когда ваш сайт работает с протоколами HTTP и HTTPS, он должен работать гладко вне зависимости от используемого протокола"
updated_on: 2015-03-27
key-takeaways:
  - "Убедитесь в том, что внутренние и внешние ссылки сайта не зависят от протоколу, т. е. убедитесь, что вы используете относительные пути, либо уберите протокол в виде //example.com/something.js"
---

<p class="intro">
  Теперь, когда ваш сайт работает с протоколами HTTP и HTTPS, он обязан работать гладко вне зависимости от используемого протокола
</p>

{% include shared/takeaway.liquid list=page.key-takeaways %}

{% include shared/toc.liquid %}

Проблема возникает, когда вы сталкиваетесь со страницей протокола HTTPS
, содержащую HTTP-ресурсы: [смешанный
контент](http://www.w3.org/TR/mixed-content/), при этом браузеры предупреждают пользователя о том, что протокол
HTTPS работает не в полную силу.

На самом деле в случае активного смешанного контента (скрипты, плагины, таблицы стилей CSS, плавающие фреймы iframe),
браузеры зачастую просто не загружают и не исполняют контент — в результате мы получаем 
нерабочую страницу.

**ПРИМЕЧАНИЕ.** Все работает, когда на HTTP-странице включены HTTPS-ресурсы.

Кроме того, когда на своем сайте вы ссылаетесь на другие страницы, пользователи
могут перейти с протокола HTTPS на HTTP.

Такие проблемы возникают, когда на вашей странице есть полноценные внутренние ссылки,
использующие схему *http://*. Вам следует изменить контент следующим образом:

		<h1>Добро пожаловать на Example.com</h1>
		<script src="http://example.com/jquery.js"></script>
		<link rel="stylesheet" href="http://assets.example.com/style.css"/>
		<img src="http://img.example.com/logo.png"/>;
		<p>Читайте нашу новую<a href="http://example.com/2014/12/24/">интересную
		публикацию о кошках!</a></p>
		<p>Загляните на этот <a href="http://foo.com/">прикольный
		сайт.</a></p>

замените на:

		<h1>Добро пожаловать на Example.com</h1>
		<script src="//example.com/jquery.js"></script>
		<link rel="stylesheet" href="//assets.example.com/style.css"/>
		<img src="//img.example.com/logo.png"/>;
		<p>Читайте нашу новую<a href="//example.com/2014/12/24/">интересную
		публикацию о кошках!</a></p>
		<p>Загляните на этот <a href="http://foo.com/">прикольный
		сайт.</a></p>

или:

		<h1>Добро пожаловать на Example.com</h1>
		<script src="/jquery.js"></script>
		<link rel="stylesheet" href="//assets.example.com/style.css"/>
		<img src="//img.example.com/logo.png"/>;
		<p>Читайте нашу новую <a href="/2014/12/24/">интересную
		публикацию о кошках!</a></p>
		<p>Загляните на этот <a href="http://foo.com/">прикольный
		сайт.</a></p>

Таким образом внутренние ссылки становятся как можно более относительными: либо относятся к протоколу 
(не имеют протокола, начинаются с //example.com), либо к хосту (начинаются
с пути, например, с /jquery.js).

**ПРИМЕЧАНИЕ.** Делайте это не вручную, а с помощью скрипта. Если содержимое вашего сайта находится в
базе данных, протестируйте ваш скрипт на резервной версии
базы данных, используемой для разработки. Если содержимое вашего сайта – простые файлы, протестируйте ваш скрипт
на резервной копии файлов, используемой для разработки. Отправляйте изменения в производство только после
того, как они прошли проверку на качество. Можете использовать скрипт [Bram van Damme's]
(https://github.com/bramus/mixed-content-scan) или аналогичные решения, чтобы
 определить смешанный контент на вашем сайте.

**ПРИМЕЧАНИЕ.** При указании ссылок на другие сайты (вместо того чтобы включать фрагменты их ресурсов)
не изменяйте протокол, поскольку вы не контролируете работу
этих сайтов.

**ПРИМЕЧАНИЕ.** Я рекомендую ссылки, зависящие от протокола, с тем чтобы миграция больших сайтов 
проходила более гладко. Если вы не уверены, что сможете полностью перейти на HTTPS, принудительное использование 
HTTPS для всех ресурсов вашего сайта может стать рискованным. Скорее всего, поначалу
HTTPS будет казаться вам новым и непонятным, и в этот период HTTP-версия должна
продолжать нормально работать. Спустя некоторое время вы завершите миграцию и можете
 работать только в HTTPS (см. следующие два раздела).

Если ваш сайт зависит от скрипта, изображения или других ресурсов третьих
сторон, например от CDN, jquery.com и т. д., у вас есть два варианта:

*Использовать для этих ресурсов ссылки, также зависящие от протокола. Если третья сторона
не работает с HTTPS, попросите их об этом. В большинстве своем такие третьи лица уже поддерживают этот протокол, например jquery.com.
* Используйте ресурсы со своих серверов, работающих как с протоколом HTTP, так и с
 HTTPS. Это всегда целесообразно, поскольку дает вам возможность лучше контролировать
 внешний вид, производительность и безопасность вашего сайта – вам не нужно
 полагаться на третьих лиц, что всегда неплохо.

Помните, что вам также будет необходимо изменить URL-адреса внутри сайта
в таблицах стилей, JavaScript, правилах перенаправления, &lt;ссылочных...&gt; тегах и синтаксических конструкциях
на CSP-страницах, а не только на HTML-страницах!

