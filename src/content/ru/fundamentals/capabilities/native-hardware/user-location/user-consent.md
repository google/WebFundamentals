project_path: /web/_project.yaml
book_path: /web/fundamentals/_book.yaml

{# wf_review_required #}
{# wf_updated_on: 2014-10-20 #}
{# wf_published_on: 2000-01-01 #}

# Получение согласия пользователя на использование данных о его местоположении {: .page-title }

{% include "web/_shared/contributors/TODO.html" %}



Доступ к данным о местоположении пользователя открывает для веб-разработчика широчайшие возможности, такие как целенаправленная фильтрация контента, определение местоположения пользователя на карте, а также упреждающее предоставление ему рекомендаций относительно возможных действий на основе текущего местоположения

Пользователь всегда будете настороженно 
относиться к просьбам указать информацию о своем местоположении и наверняка согласится предоставить такие сведения только тем, кому доверяет.  Именно поэтому в браузере 
отображается соответствующий запрос, когда сайту требуются данные о вашем местоположении.


<a href="http://static.googleusercontent.com/media/www.google.com/en/us/intl/ALL_ALL/think/multiscreen/pdf/multi-screen-moblie-whitepaper_research-studies.pdf">Результаты недавних исследований</a> свидетельствуют, 
что пользователи не доверяют сайтам, на которых их просят предоставить данные о местоположении сразу 
при загрузке страницы. Так как же лучше всего поступить в таких случаях?

## TL;DR {: .hide-from-toc }
- 'Всегда имейте в виду, что пользователи могут отказаться предоставлять информацию о своем местоположении.'
- Четко поясняйте для чего вам требуется доступ к данным о местоположении пользователя.
- Не запрашивайте доступ к данным геолокации сразу при загрузке страницы.


## Всегда имейте в виду, что пользователи могут отказаться предоставлять информацию о своем местоположении

Как бы это ни было огорчительно, но большинство ваших пользователей откажутся предоставлять вам информацию 
о своем местоположении, поэтому при разработке сайта заранее учтите этот факт.

1.  Обеспечьте обработку всех ошибок вне API геолокации, чтобы адаптировать ваш 
сайт к такому поведению пользователей.
2.  Четко и ясно поясняйте, для чего вам нужна информация о местоположении.
3.  При необходимости используйте запасной вариант решения.

## Используйте запасной вариант, если требуются данные геолокации

Мы рекомендуем организовать работу вашего сайта или приложения таким образом, чтобы они могли обойтись без
информации о текущем местоположении пользователя, однако если эти данные
им требуются непременно, можно воспользоваться сторонними решениями, которые позволяют
получить наиболее вероятное предположение о том, где находится пользователь.

Зачастую такие решения основаны на определении IP-адреса устройства пользователя и сопоставлении этих данных 
с физическими адресами, зарегистрированными в базе данных RIPE.  Такие способы позволяют
определить приблизительное местоположение пользователя на основе данных о расположении ближайшего к пользователю
узла связи или базовой станции оператора сотовой связи.  В большинстве случаев
точность определения местоположения таким способом не гарантируется, особенно в случаях, когда используется подключение через VPN
или иная прокси-служба.

## Доступ к информации о местоположении всегда следует запрашивать, ориентируясь на действия пользователя

Пользователи должны четко понимать, зачем вам нужны эти сведения и
какую пользу они получат от этого.  Запрос информации о местоположении сразу при загрузке домашней страницы 
сайта – прекрасный пример того, как не следует делать.

<div class="clear g-wide--pull-1">
  <div class="mdl-cell mdl-cell--6--col">
    <figure class="fluid">
      <img src="images/sw-navigation-bad.png" srcset="images/sw-navigation-bad.png 1x, images/sw-navigation-bad-2x.png 2x" alt="">
      <figcaption>Запрос информации о местоположении сразу при загрузке домашней страницы сайта – прекрасный пример того, как не следует делать.</figcaption>
    </figure>
  </div>
  <div class="mdl-cell mdl-cell--6--col">
    <figure class="fluid">
      <img src="images/sw-navigation-good.png" srcset="images/sw-navigation-good.png 1x, images/sw-navigation-good-2x.png 2x" alt="">
      <figcaption>Доступ к информации о местоположении всегда следует запрашивать, ориентируясь на действия пользователя.</figcaption>
      </figure>
  </div>
</div>

Вместо этого вы должны дать пользователю четкий призыв к действию или указание того,
что для выполнения операции требуется доступ к информации о местоположении пользователя.  Это позволит пользователю
без труда связать такой запрос с только что
начатым им действием.

## Ясно давайте понять, что для выполнения действия требуются данные геолокации

<a href="http://static.googleusercontent.com/media/www.google.com/en/us/intl/ALL_ALL/think/multiscreen/pdf/multi-screen-moblie-whitepaper_research-studies.pdf">В исследовании, проведенном командой Google Ads</a>, пользователей просили забронировать номер в гостинице в Бостоне на определенном сайте бронирования. Сразу после нажатия кнопки "Найти и забронировать" на главной странице сайта им было предложено указать свое местоположение на основе данных GPS.

В ряде случаев пользовали пришли в недоумение, поскольку они не могли понять,
почему в результатах поиска отображаются гостиницы в Сан-Франциско, когда номер нужно забронировать в 
Бостоне.

Лучше будет указать, в каких
целях у пользователей интересуются сведениями об их текущем местоположении. Добавьте хорошо узнаваемое обозначение, которое 
широко используется на различных устройствах (например, определение расстояния).

<img src="images/indication.png">

Также можно использовать явный призыв к действию, такой как "Find Near Me" (Найти поблизости от меня).

<img src="images/nearme.png">

## Ненавязчиво намекните пользователям, что вам необходим доступ к данным геолокации

Вам не известно, предпримет ли пользователь какие-либо действия для предоставления соответствующей информации.  Когда 
пользователь отказался предоставлять данные о своем место нахождении, вы безусловно узнаете об этом, однако 
положительный ответ вы получите только при отображении результатов использования функции геолокации.

Рекомендуется побудить пользователя к выполнению действия, если вам требуется, чтобы он выполнил его.

Вот что мы рекомендуем: 

1.  Настройте таймер, который будет срабатывать по прошествии короткого периода времени (5 секунд вполне достаточно).
2.  При получении сообщения об ошибке на экране должно отображаться соответствующее сообщение.
3.  В случае положительного ответа таймер отключается и начинается обработка полученного результата.
4.  Если после тайм-аута положительный ответ так и не получен, на экране должно отображаться соответствующее уведомление.
5.  Если ответ последовал позже, а уведомление по-прежнему отображается, его необходимо отключить.


    button.onclick = function() {
      var startPos;
      var element = document.getElementById("nudge");
    
      var showNudgeBanner = function() {
        nudge.style.display = "block";
      };
    
      var hideNudgeBanner = function() {
        nudge.style.display = "none";
      };
    
      var nudgeTimeoutId = setTimeout(showNudgeBanner, 5000);
    
      var geoSuccess = function(position) {
        hideNudgeBanner();
        // We have the location, don't display banner
        clearTimeout(nudgeTimeoutId); 
    
        // Do magic with location
        startPos = position;
        document.getElementById('startLat').innerHTML = startPos.coords.latitude;
        document.getElementById('startLon').innerHTML = startPos.coords.longitude;
      };
      var geoError = function(error) {
        switch(error.code) {
          case error.TIMEOUT:
            // The user didn't accept the callout
            showNudgeBanner();
            break;
      };
    
      navigator.geolocation.getCurrentPosition(geoSuccess, geoError);
    };
    

