<!DOCTYPE html>
<html devsite>

<head>
  <meta name="project_path" value="/web/tools/workbox/_project.yaml" />
  <meta name="book_path" value="/web/tools/workbox/_book.yaml" />
  <meta name="gtm_var" data-key="docType" data-value="reference">
  <title>Source: workbox-build/src/lib/get-file-manifest-entries.js</title>
  <link href="jsdoc.css" rel="stylesheet">
</head>

<body>
  <div id="jsdoc-body-container">
    <div id="jsdoc-content">
      <div id="jsdoc-content-container">
        <div id="jsdoc-banner" role="banner">
        </div>
        <div id="jsdoc-main" role="main">
          <header class="page-header">
            <h1>Source: workbox-build/src/lib/get-file-manifest-entries.js</h1>
          </header>
          <article>
            <pre class="prettyprint linenums"><code>/*
  Copyright 2017 Google Inc.

  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      https://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
*/

const assert &#x3D; require(&#x27;assert&#x27;);
const path &#x3D; require(&#x27;path&#x27;);

const errors &#x3D; require(&#x27;./errors&#x27;);
const filterFiles &#x3D; require(&#x27;./filter-files&#x27;);
const getCompositeDetails &#x3D; require(&#x27;./get-composite-details&#x27;);
const getFileDetails &#x3D; require(&#x27;./get-file-details&#x27;);
const getStringDetails &#x3D; require(&#x27;./get-string-details&#x27;);

/**
 * @typedef {Object} ManifestEntry
 * @property {String} url The URL to the asset in the manifest.
 * @property {String} revision The revision details for the file. This is a
 * hash generated by node based on the file contents.
 *
 * @memberof module:workbox-build
 */

module.exports &#x3D; async ({
  dontCacheBustUrlsMatching,
  globDirectory,
  globIgnores,
  globPatterns,
  manifestTransforms,
  maximumFileSizeToCacheInBytes,
  modifyUrlPrefix,
  swDest,
  templatedUrls,
}) &#x3D;&gt; {
  // Initialize to an empty array so that we can still pass something to
  // filterFiles() and get a normalized output.
  let fileDetails &#x3D; [];
  const fileSet &#x3D; new Set();

  if (globDirectory) {
    if (swDest) {
      // Ensure that we ignore the SW file we&#x27;re eventually writing to disk.
      globIgnores.push(&#x60;**/${path.basename(swDest)}&#x60;);
    }

    fileDetails &#x3D; globPatterns.reduce((accumulated, globPattern) &#x3D;&gt; {
      const globbedFileDetails &#x3D; getFileDetails({
        globDirectory,
        globPattern,
        globIgnores,
      });

      globbedFileDetails.forEach((fileDetails) &#x3D;&gt; {
        if (fileSet.has(fileDetails.file)) {
          return;
        }

        fileSet.add(fileDetails.file);
        accumulated.push(fileDetails);
      });
      return accumulated;
    }, []);
  }

  if (templatedUrls) {
    for (let url of Object.keys(templatedUrls)) {
      assert(!fileSet.has(url), errors[&#x27;templated-url-matches-glob&#x27;]);

      const dependencies &#x3D; templatedUrls[url];
      if (Array.isArray(dependencies)) {
        const details &#x3D; dependencies.reduce((previous, globPattern) &#x3D;&gt; {
          try {
            const globbedFileDetails &#x3D; getFileDetails({
              globDirectory,
              globPattern,
              globIgnores,
            });
            return previous.concat(globbedFileDetails);
          } catch (error) {
            const debugObj &#x3D; {};
            debugObj[url] &#x3D; dependencies;
            throw new Error(&#x60;${errors[&#x27;bad-template-urls-asset&#x27;]} &#x60; +
              &#x60;&#x27;${globPattern}&#x27; from &#x27;${JSON.stringify(debugObj)}&#x27;:\n&#x60; +
              error);
          }
        }, []);
        fileDetails.push(getCompositeDetails(url, details));
      } else if (typeof dependencies &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
        fileDetails.push(getStringDetails(url, dependencies));
      }
    }
  }

  return filterFiles({fileDetails, maximumFileSizeToCacheInBytes,
    modifyUrlPrefix, dontCacheBustUrlsMatching, manifestTransforms});
};
</code></pre>
          </article>
        </div>
      </div>
      <nav id="jsdoc-toc-nav" role="navigation"></nav>
    </div>
  </div>
</body>

</html>
