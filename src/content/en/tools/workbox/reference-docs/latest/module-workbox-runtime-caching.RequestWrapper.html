<!DOCTYPE html>
<html devsite>

<head>
  <meta name="project_path" value="/web/tools/_project.yaml" />
  <meta name="book_path" value="/web/tools/_book.yaml" />
  <meta name="gtm_var" data-key="docType" data-value="reference">
  <title>Class: RequestWrapper</title>
  <link href="jsdoc.css" rel="stylesheet">
</head>

<body>
  <div id="jsdoc-body-container">
    <div id="jsdoc-content">
      <div id="jsdoc-content-container">
        <div id="jsdoc-main" role="main">
          <header class="page-header">
            <h1><small><a href="module-workbox-runtime-caching.html">workbox-runtime-caching</a>.<wbr></small><span class="symbol-name">RequestWrapper</span></h1>
            <div class="symbol-detail-labels"><span class="label label-kind"><small>class</small></span>&nbsp;&nbsp;&nbsp;<span class="label label-static"><small>static</small></span></div>
            <p>This class is used by the various subclasses of
              <a href="module-workbox-runtime-caching.Handler.html">Handler</a> to configure the cache name and any desired plugins, which is to say classes that implement request lifecycle callbacks.</p>
            <p>It automatically triggers any registered callbacks at the appropriate time.</p>
          </header>
          <section>
            <h2>Constructor</h2>
            <section>
              <h3 id="RequestWrapper" class="symbol-name">RequestWrapper</h3>
              <p class="type-signature"> new RequestWrapper(input)
              </p>
              <p>Constructor for RequestWrapper.</p>
              <section>
                <table class="function param responsive">
                  <tr>
                    <th colspan="2">
                      <h4>Parameter</h4>
                    </th>
                  </tr>
                  <tbody>
                    <tr>
                      <td class="details-table-name">
                        <p>input</p>
                      </td>
                      <td>
                        <p class="details-table-types">Object</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </section>
              <dl class="dl-compact">
              </dl>
            </section>
          </section>
          <section>
            <h2>Methods</h2>
            <section>
              <h3 id="fetch" class="symbol-name">fetch</h3>
              <div class="symbol-detail-labels"><span class="label label-async"><small>async</small></span></div>
              <p class="type-signature"> fetch(input)&nbsp;returns&nbsp;Promise containing Response</p>
              <p>Wraps <code>fetch()</code>, calls all <code>requestWillFetch</code> before making the network request, and calls any <code>fetchDidFail</code> callbacks from the registered plugins if the request fails.</p>
              <section>
                <table class="function param responsive">
                  <tr>
                    <th colspan="2">
                      <h4>Parameter</h4>
                    </th>
                  </tr>
                  <tbody>
                    <tr>
                      <td class="details-table-name">
                        <p>input</p>
                      </td>
                      <td>
                        <p class="details-table-types">Object</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </section>
              <dl class="dl-compact">
                <dt>Returns</dt>
                <dd>
                  <p><code>Promise containing Response</code>&nbsp;The network response.</p>
                </dd>
              </dl>
              <section>
                <h4>
                  Example
                </h4>
                <div>
                  <pre class="prettyprint"><code>requestWrapper.fetch({
  request: event.request
})
.then((response) &#x3D;&gt; {
 ...
})
.catch((err) &#x3D;&gt; {
  ...
});</code></pre>
                </div>
              </section>
              <h3 id="fetchAndCache" class="symbol-name">fetchAndCache</h3>
              <div class="symbol-detail-labels"><span class="label label-async"><small>async</small></span></div>
              <p class="type-signature"> fetchAndCache(input)&nbsp;returns&nbsp;Promise containing Response</p>
              <p>Combines both fetching and caching using the previously configured options and calling the appropriate plugins.</p>
              <p>By default, responses with a status of <a href="https://fetch.spec.whatwg.org/#ok-status">2xx</a> will be considered valid and cacheable, but this could be overridden by configuring one or more plugins that implement the <code>cacheWillUpdate</code>                lifecycle callback.</p>
              <section>
                <table class="function param responsive">
                  <tr>
                    <th colspan="2">
                      <h4>Parameter</h4>
                    </th>
                  </tr>
                  <tbody>
                    <tr>
                      <td class="details-table-name">
                        <p>input</p>
                      </td>
                      <td>
                        <p class="details-table-types">Object</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </section>
              <dl class="dl-compact">
                <dt>Returns</dt>
                <dd>
                  <p><code>Promise containing Response</code>&nbsp;The network response.</p>
                </dd>
              </dl>
              <section>
                <h4>
                  Example
                </h4>
                <div>
                  <pre class="prettyprint"><code>requestWrapper.fetchAndCache({
  request: event.request
})
.then((response) &#x3D;&gt; {
 ...
})
.catch((err) &#x3D;&gt; {
  ...
});</code></pre>
                </div>
              </section>
              <h3 id="getCache" class="symbol-name">getCache</h3>
              <div class="symbol-detail-labels"><span class="label label-async"><small>async</small></span></div>
              <p class="type-signature"> getCache()&nbsp;returns&nbsp;Promise containing Cache</p>
              <p>Opens a cache and maintains a reference to that cache for future use.</p>
              <dl class="dl-compact">
                <dt>Returns</dt>
                <dd>
                  <p><code>Promise containing Cache</code>&nbsp;An open <code>Cache</code> instance based on the configured
                    <code>cacheName</code>.</p>
                </dd>
              </dl>
              <section>
                <h4>
                  Example
                </h4>
                <div>
                  <pre class="prettyprint"><code>requestWrapper.getCache()
.then((openCache) &#x3D;&gt; {
   ...
});</code></pre>
                </div>
              </section>
              <h3 id="match" class="symbol-name">match</h3>
              <div class="symbol-detail-labels"><span class="label label-async"><small>async</small></span></div>
              <p class="type-signature"> match(input)&nbsp;returns&nbsp;Promise containing Response</p>
              <p>Wraps <code>cache.match()</code>, using the previously configured cache name and match options.
              </p>
              <section>
                <table class="function param responsive">
                  <tr>
                    <th colspan="2">
                      <h4>Parameter</h4>
                    </th>
                  </tr>
                  <tbody>
                    <tr>
                      <td class="details-table-name">
                        <p>input</p>
                      </td>
                      <td>
                        <p class="details-table-types">Object</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </section>
              <dl class="dl-compact">
                <dt>Returns</dt>
                <dd>
                  <p><code>Promise containing Response</code>&nbsp;The cached response.</p>
                </dd>
              </dl>
              <section>
                <h4>
                  Example
                </h4>
                <div>
                  <pre class="prettyprint"><code>requestWrapper.match({event.request})
.then((response) &#x3D;&gt; {
  if (!response) {
    // No response in cache.
    return;
  }
  ...
});</code></pre>
                </div>
              </section>
            </section>
            <h2>Abstract types</h2>
            <section>
              <h3 id=".cacheDidUpdate" class="symbol-name">cacheDidUpdate</h3>
              <div class="symbol-detail-labels"><span class="label label-static"><small>static</small></span></div>
              <p class="type-signature"> cacheDidUpdate(input)</p>
              <p>Called after a response has been written to the cache.</p>
              <section>
                <table class="function param responsive">
                  <tr>
                    <th colspan="2">
                      <h4>Parameter</h4>
                    </th>
                  </tr>
                  <tbody>
                    <tr>
                      <td class="details-table-name">
                        <p>input</p>
                      </td>
                      <td>
                        <p class="details-table-types">Object</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </section>
              <dl class="dl-compact">
              </dl>
              <section>
                <h4>
                  Example
                </h4>
                <div>
                  <p>Logs a message when the cache has been updated.</p>
                  <pre class="prettyprint"><code>async function cacheDidUpdate({cacheName, url}) {
  console.log(&#x60;The entry for ${url} in cache ${cacheName} was updated.&#x60;);
}</code></pre>
                </div>
              </section>
              <h3 id=".cachedResponseWillBeUsed" class="symbol-name">cachedResponseWillBeUsed</h3>
              <div class="symbol-detail-labels"><span class="label label-static"><small>static</small></span></div>
              <p class="type-signature"> cachedResponseWillBeUsed(input)&nbsp;returns&nbsp;Promise containing (Response or null)</p>
              <p>Called before a previously cached response that has been read from the cache is used. This allows you to modify it or return <code>null</code> if it's not valid.</p>
              <section>
                <table class="function param responsive">
                  <tr>
                    <th colspan="2">
                      <h4>Parameter</h4>
                    </th>
                  </tr>
                  <tbody>
                    <tr>
                      <td class="details-table-name">
                        <p>input</p>
                      </td>
                      <td>
                        <p class="details-table-types">Object</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </section>
              <dl class="dl-compact">
                <dt>Returns</dt>
                <dd>
                  <p><code>Promise containing (Response or null)</code>&nbsp;The response to be used as the effective cache match. This might be the same response as <code>cachedResponse</code>, if it was valid, a modified version of the response, or <code>null</code>                    if there's no valid match.
                  </p>
                </dd>
              </dl>
              <section>
                <h4>
                  Example
                </h4>
                <div>
                  <pre class="prettyprint"><code>&lt;caption&gt;Returns &#x60;null&#x60; to indicate that a cached response shouldn&#x27;t
be used if its Date header is too far in the past.&lt;/caption&gt;

async function cachedResponseWillBeUsed({cachedResponse}) {
  if (cachedResponse) {
    const dateHeader &#x3D; cachedResponse.headers.get(&#x27;date&#x27;);
    const date &#x3D; new Date(dateHeader);
    if (dateHeader &amp;&amp; (Date.now() - date.getTime()) &lt; 1000) {
      return cachedResponse;
    }
  }

  return null;
}</code></pre>
                </div>
              </section>
              <h3 id=".cacheWillUpdate" class="symbol-name">cacheWillUpdate</h3>
              <div class="symbol-detail-labels"><span class="label label-static"><small>static</small></span></div>
              <p class="type-signature"> cacheWillUpdate(input)&nbsp;returns&nbsp;Promise containing Boolean</p>
              <p>Called prior to a response being written to the cache. This allows you to prevent the cache from being updated if the response doesn't meet your custom criteria.</p>
              <section>
                <table class="function param responsive">
                  <tr>
                    <th colspan="2">
                      <h4>Parameter</h4>
                    </th>
                  </tr>
                  <tbody>
                    <tr>
                      <td class="details-table-name">
                        <p>input</p>
                      </td>
                      <td>
                        <p class="details-table-types">Object</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </section>
              <dl class="dl-compact">
                <dt>Returns</dt>
                <dd>
                  <p><code>Promise containing Boolean</code>&nbsp;<code>true</code> if the response meets your criteria for being added to the appropriate cache, and <code>false</code> if it doesn't.</p>
                </dd>
              </dl>
              <section>
                <h4>
                  Example
                </h4>
                <div>
                  <pre class="prettyprint"><code>&lt;caption&gt;Determines whether a response is cacheable based on
whether its Cache-Control header contains the string &#x27;no-cache&#x27;.&lt;/caption&gt;

async function cacheWillUpdate({response}) {
  return !response.headers.get(&#x27;cache-control&#x27;).includes(&#x27;no-cache&#x27;);
}</code></pre>
                </div>
              </section>
              <h3 id=".fetchDidFail" class="symbol-name">fetchDidFail</h3>
              <div class="symbol-detail-labels"><span class="label label-static"><small>static</small></span></div>
              <p class="type-signature"> fetchDidFail(input)</p>
              <p>Called after a network request has failed. This allows you to report the failure, or save a copy of the failed request to be retried later.</p>
              <section>
                <table class="function param responsive">
                  <tr>
                    <th colspan="2">
                      <h4>Parameter</h4>
                    </th>
                  </tr>
                  <tbody>
                    <tr>
                      <td class="details-table-name">
                        <p>input</p>
                      </td>
                      <td>
                        <p class="details-table-types">Object</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </section>
              <dl class="dl-compact">
              </dl>
              <section>
                <h4>
                  Example
                </h4>
                <div>
                  <p>Logs a message when a network request fails.</p>
                  <pre class="prettyprint"><code>async function fetchDidFail({request}) {
  const body &#x3D; await request.text();
  console.log(&#x60;A request for ${request.url} with body ${body} failed.&#x60;);
}</code></pre>
                </div>
              </section>
              <h3 id=".requestWillFetch" class="symbol-name">requestWillFetch</h3>
              <div class="symbol-detail-labels"><span class="label label-static"><small>static</small></span></div>
              <p class="type-signature"> requestWillFetch(input)&nbsp;returns&nbsp;Promise containing Request</p>
              <p>Called prior to a network request being made. This allows you to update the request's URL or headers as appropriate, or just return the original request if there are no modifications needed.</p>
              <section>
                <table class="function param responsive">
                  <tr>
                    <th colspan="2">
                      <h4>Parameter</h4>
                    </th>
                  </tr>
                  <tbody>
                    <tr>
                      <td class="details-table-name">
                        <p>input</p>
                      </td>
                      <td>
                        <p class="details-table-types">Object</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </section>
              <dl class="dl-compact">
                <dt>Returns</dt>
                <dd>
                  <p><code>Promise containing Request</code>&nbsp;The request that will be used against the network instead.
                  </p>
                </dd>
              </dl>
              <section>
                <h4>
                  Example
                </h4>
                <div>
                  <p>Appends a URL parameter to all outgoing requests.</p>
                  <pre class="prettyprint"><code>async function requestWillFetch({request}) {
  const url &#x3D; new URL(request.url);
  url.searchParams.set(&#x27;from-workbox&#x27;, &#x27;true&#x27;);
  return new Request(url.href, {headers: request.headers});
}</code></pre>
                </div>
              </section>
            </section>
          </section>
        </div>
      </div>
      <nav id="jsdoc-toc-nav" role="navigation"></nav>
    </div>
  </div>
</body>

</html>