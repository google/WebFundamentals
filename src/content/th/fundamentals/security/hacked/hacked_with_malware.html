<html devsite><head>
  <title>ถูกแฮ็กให้แพร่กระจายมัลแวร์</title>
  <meta name="project_path" value="/web/fundamentals/_project.yaml"/>
  <meta name="book_path" value="/web/fundamentals/_book.yaml"/>
</head>
  <body>
<p>ขั้นตอนนี้จะใช้กับไซต์ที่ถูกแฮ็กให้แพร่กระจายมัลแวร์ ซึ่งมักแสดงคำเตือน <em>"ไซต์นี้อาจเป็นอันตรายต่อคอมพิวเตอร์ของคุณ"</em> ในผลการค้นหา นี่เป็นขั้นตอนหนึ่งในกระบวนการกู้คืนที่ใช้ระยะเวลานานที่สุด  ในขั้นตอนนี้ คุณจะต้องรวบรวมรายชื่อไฟล์ที่เสียหายในไซต์
  ซึ่งจะนำไปใช้ในขั้นตอน<a href="clean_site">ทำความสะอาดและดูแลรักษาไซต์</a>ต่อไป</p>
  <p>หากไซต์ถูกแฮ็กให้แสดงสแปมแทนที่จะแพร่กระจายมัลแวร์ ระบบจะแสดงคำเตือน <em>"ไซต์นี้อาจถูกแฮ็ก"</em> ในผลการค้นหา โปรดดูหน้า<a href="hacked_with_spam">ประเมินความเสียหายจากสแปม (ถูกแฮ็กให้แสดงสแปม)</a></p>

    <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="Snt45fZQIiU" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<h3>คุณจะต้องมีสิ่งต่อไปนี้</h3>
<ul>
  <li>สิทธิ์เข้าถึงเซิร์ฟเวอร์ของไซต์ ไม่ว่าจะเป็นเว็บ ฐานข้อมูล หรือไฟล์ ในระดับผู้ดูแลระบบผ่านทาง Shell/เทอร์มินัล</li>
  <li>ความรู้เกี่ยวกับคำสั่ง Shell/เทอร์มินัล</li>
  <li>ความสามารถในการเรียกใช้รูปแบบของ SQL ในฐานข้อมูล</li>
</ul>
<h3>สิ่งที่คุณต้องดำเนินการ</h3>

<div class="action">
<p>ขั้นตอนนี้มี 3 ส่วนคือ</p>
<ul>
  <li><a href="#preparation">การจัดเตรียม</a></li>
  <li><a href="#investigation">การตรวจสอบประเภทการติดมัลแวร์ที่เฉพาะเจาะจง</a></li>
  <li><a href="#assessment">การประเมินความเสียหายของระบบไฟล์โดยทั่วไป</a></li>
</ul>
</div>

<a name="preparation"></a>
<h3>การจัดเตรียม</h3>
<ol>
  <li>หลีกเลี่ยงการใช้เบราว์เซอร์เพื่อดูหน้าในไซต์ เนื่องจากมัลแวร์มักจะแพร่กระจายโดยใช้ช่องโหว่ของเบราว์เซอร์ การเปิดหน้าเว็บที่ติดมัลแวร์ในเบราว์เซอร์อาจทำให้คอมพิวเตอร์เสียหายได้</li>
  <li>สร้างเอกสารสำหรับบันทึกสิ่งที่พบในขั้นตอนนี้ ซึ่งท้ายที่สุดแล้ว จะมีชื่อ/ตำแหน่งของแต่ละไฟล์ที่เสียหาย และข้อมูลเกี่ยวกับการติดมัลแวร์ (เป็นอย่างน้อย) โดยจะใช้เป็นข้อมูลพื้นฐานในการ<a href="clean_site">ทำความสะอาดและดูแลรักษาไซต์</a></li>
  <li>ตรวจสอบแหล่งข้อมูลเพิ่มเติมตามความจำเป็น
    <ul>
      <li>ชมวิดีโอด้านบนเพื่อดูวิธีการทำงานของมัลแวร์ รวมถึงวิธีที่จะช่วยให้คุณปลอดภัยในระหว่างการตรวจสอบมัลแวร์</li>
      <li>ดู<a href="/safe-browsing/">หน้าการวินิจฉัยของ Google Safe Browsing</a> เพื่อดูข้อมูลสาธารณะเกี่ยวกับการเป็นอันตรายต่อผู้ใช้ของไซต์ต่างๆ และดูสถานะที่แสดงอยู่ของไซต์ของคุณได้ที่ URL ที่มีลักษณะดังนี้
      <pre>http://www.google.com/safebrowsing/diagnostic?site=&lt;your-site&gt;</pre>
      ตัวอย่างเช่น <code>http://www.google.com/safebrowsing/diagnostic?site=webmastercentralblog.blogspot.com</code></li>
    </ul>
  </li>
  <li>ใช้ <a href="https://www.google.com/search?q=cURL">cURL</a> หรือ <a href="https://www.google.com/search?q=Wget">Wget</a> ในการส่งคำขอ HTTP (เช่น เพื่อดึงหน้าเว็บ)
    <p>เครื่องมือที่ใช้งานฟรีเหล่านี้มีประโยชน์ในการวิเคราะห์การเปลี่ยนเส้นทาง ทั้งยังมีความยืดหยุ่นในการรวมข้อมูลผู้อ้างอิงหรือ User-agent ซึ่งการรวมข้อมูลผู้อ้างอิงหรือ User-agent ไว้อย่างเจาะจงดังกล่าว จะช่วยในการเลียนแบบแฮ็กเกอร์ เนื่องจากแฮ็กเกอร์อาจแสดงเนื้อหาที่เป็นอันตรายแก่ผู้ใช้ที่ใช้ User-agent หรือผู้อ้างอิงเฉพาะบางอย่างเท่านั้นเพื่อกำหนดเป้าหมายไปยัง "ผู้ที่มีตัวตนอยู่จริง" ให้มากขึ้นและสามารถหลีกเลี่ยงการตรวจจับของเจ้าของไซต์และโปรแกรมสแกนมัลแวร์ได้</p>
    <pre>$curl -v --referer "http://www.google.com" &lt;your-url&gt;</pre></li>
</ol>

<a name="investigation"></a>
<h3>การตรวจสอบประเภทการติดมัลแวร์ที่เฉพาะเจาะจงในไซต์</h3>
<ol>
  <li>เลือกไซต์ที่ได้รับการยืนยันของคุณใน Search Console แล้วคลิก<strong>ปัญหาด้านความปลอดภัย</strong></li>
  <li> ตรวจสอบหมวดหมู่ของมัลแวร์ทั้งหมด (เช่น การกำหนดค่าเซิร์ฟเวอร์ การแทรก SQL) ที่แสดงอยู่ใน "ปัญหาด้านความปลอดภัย" ของไซต์ โดยดูข้อมูลเพิ่มเติมเกี่ยวกับ URL ที่ติดเชื้อจากหมวดหมู่นั้นๆ ได้โดยคลิก “แสดงรายละเอียด” (รายละเอียดอาจมีตัวอย่างข้อมูลโค้ดที่แฮ็กเกอร์ได้แทรกไว้) ทั้งนี้สำหรับแต่ละหมวดหมู่ ให้คัดลอกข้อมูลต่อไปนี้ลงในเอกสารการตรวจสอบ
    <ul>
      <li>ตัวอย่าง URL ทั้งหมดที่ถูกโจมตีซึ่งแสดงอยู่ในปัญหาด้านความปลอดภัยของหมวดมัลแวร์</li>
      <li>หน้าเว็บที่เสียหายเพิ่มเติมที่คุณพบในระหว่างการตรวจสอบ</li>
      <li>รายละเอียดเกี่ยวกับ URL ที่ถูกโจมตีที่พบ เช่น ประเภทของความเสียหายที่เกิดขึ้น</li>
    </ul>
  </li>
  <li>คุณสามารถดูข้อมูลที่จะช่วยในการตรวจสอบมัลแวร์แต่ละประเภทได้ที่ด้านล่าง
    <ul>
      <li><a href="https://www.support.google.com/webmasters/answer/3024318">การกำหนดค่าเซิร์ฟเวอร์</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024309">การแทรก SQL</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024381">เทมเพลตข้อผิดพลาด</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024344">การแทรกโค้ด</a></li>
    </ul>
  </li>
</ol>

<a name="assessment"></a>
<h4>การประเมินความเสียหายของระบบไฟล์</h4>
        <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="2A4dLkXXUjo" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<p>จากนั้น คุณจะต้องเข้าสู่ระบบไฟล์ของไซต์เพื่อตรวจสอบในเชิงลึกมากขึ้น โปรดทราบว่าสิ่งที่แฮ็กเกอร์อาจทำนอกเหนือจากสิ่งอื่นๆ อีกมากมายได้แก่ แก้ไขหน้าเว็บที่มีอยู่หรือข้อมูลในฐานข้อมูล สร้างหน้าสแปมขึ้นใหม่ทั้งหน้า เขียนฟังก์ชันการทำงานให้แสดงสแปมในหน้าปกติ หรือสร้าง "ประตูหลัง" ทิ้งไว้เพื่อให้ตนเข้าไปยังไซต์ได้อีกหรือเพื่อทำอันตรายต่อไปได้ หากไม่ลบประตูนั้นออก</p>
<p>หากไซต์ออนไลน์อยู่ คุณสามารถทำให้ไซต์ออฟไลน์เพื่อทำขั้นตอนนี้</p>
<ol>
  <li>หากคุณมีข้อมูลสำรองของไซต์ซึ่งปราศจากปัญหาใดๆ ให้ระบุว่าไฟล์ใดสร้างขึ้นหรือมีการแก้ไขหลังจากวันที่สำรองข้อมูลดังกล่าว ให้เพิ่มไฟล์เหล่านี้ลงในรายการ เนื่องจากคุณน่าจะต้องการตรวจสอบต่อไป โดยในระบบ Unix คุณจะใช้คำสั่งต่อไปนี้ได้
  <pre>$ diff -qr &lt;current-directory&gt; &lt;backup-directory&gt;</pre>
  ตัวอย่างเช่น
  <pre>$ diff -qr www/ backups/full-backup-20120124/</pre>
  และ
  <pre>$ md5sum &lt;current-page&gt; &lt;backup-page&gt;</pre>
  ตัวอย่างเช่น
  <pre>$ md5sum www/page.html backups/full-backup-20120124/page.html</pre></li>
  <li>ตรวจสอบ<strong>บันทึกของเซิร์ฟเวอร์ การเข้าถึง และข้อผิดพลาด</strong> เพื่อหากิจกรรมที่น่าสงสัย เช่น การพยายามเข้าสู่ระบบที่ล้มเหลว ประวัติคำสั่ง (โดยเฉพาะอย่างยิ่งที่สั่งจากราก) การสร้างบัญชีผู้ใช้ที่ไม่รู้จัก และอื่นๆ โปรดทราบว่าแฮ็กเกอร์อาจมีการแก้ไขบันทึกเหล่านี้เพื่อวัตถุประสงค์ส่วนตัว (หากข้อมูลนี้มีประโยชน์ โปรดดูตัวอย่างในวิดีโอของขั้นตอน<a href="vulnerability">ระบุช่องโหว่</a>)</li>
  <li>ตรวจสอบ<strong>ไฟล์การกำหนดค่า</strong> เช่น .htaccess และ httpd.conf สำหรับการเปลี่ยนเส้นทาง
    แฮกเกอร์มักจะสร้างเงื่อนไขการเปลี่ยนเส้นทางตาม user-agent ช่วงเวลาของวัน หรือผู้อ้างอิง</li>
  <li>ตรวจหาการให้สิทธิ์เข้าถึงโฟลเดอร์และไฟล์ที่มากเกินไป แฮ็กเกอร์จะไปยุ่งวุ่นวายกับสิทธิ์ต่างๆ เพราะถ้าเจ้าของไซต์ยังคงไม่พบการให้สิทธิ์ที่หละหลวม แฮ็กเกอร์ก็จะยังมีวิธีกลับเข้าไปยังไซต์ได้อีก ไฟล์ที่ได้รับสิทธิ์มากกว่า 644 (rw-r--r--) และโฟลเดอร์ที่ได้รับสิทธิ์มากกว่า 755 (rwxr-xr-x) อาจทำให้เกิดปัญหาด้านความปลอดภัย ตรวจสอบว่าการให้สิทธิ์อย่างหละหลวมนั้นเกินความจำเป็นไหม โดยในระบบ Unix ให้ลองใช้คำสั่งต่อไปนี้
  <pre>$ find &lt;your-dir&gt; -type d -not -perm 755 -exec ls -ld {} \;</pre>
  <pre>$ find &lt;your-dir&gt; -type f -not -perm 644 -exec ls -la {} \;</pre></li>
  <li>หากคุณมีฐานข้อมูล ให้ตรวจสอบข้อมูลแต่ละรายการโดยใช้เครื่องมืออย่างเช่น <a href="https://www.phpmyadmin.net/home_page/index.php">phpMyAdmin</a></li>
</ol>

<h2>ขั้นตอนถัดไป</h2>
<p>ขั้นตอนถัดไปในกระบวนการนี้คือ<a href="vulnerability">ระบุช่องโหว่</a></p>

</body></html>
