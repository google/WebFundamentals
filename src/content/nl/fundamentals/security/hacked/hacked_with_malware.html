<html devsite><head>
  <title>Gehackt met malware</title>
  <meta name="project_path" value="/web/fundamentals/_project.yaml"/>
  <meta name="book_path" value="/web/fundamentals/_book.yaml"/>
</head>
  <body>
<p>Deze stap is van toepassing op sites die zijn gehackt om malware te verspreiden. Vaak wordt in zoekresultaten de waarschuwing <em>Deze site kan schade toebrengen aan uw computer</em> weergegeven. Deze stap is een van de langste in het herstelproces.  In deze stap stelt u een lijst samen van de beschadigde bestanden op uw site.
  U gebruikt deze lijst in de latere stap <a href="clean_site">Uw site schoonmaken en bijhouden</a>.</p>
  <p>Als uw site is geïnfecteerd met spam – dus niet met malware – en in zoekresultaten de waarschuwing <em>Deze site is mogelijk gehackt</em> wordt weergegeven, leest u de pagina <a href="hacked_with_spam">Schade door spam beoordelen (gehackt met spam)</a>.</p>

    <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="Snt45fZQIiU" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<h3>Wat u nodig heeft:</h3>
<ul>
  <li>Beheerderstoegang via shell/terminal tot de servers van uw site: internet, database, bestanden</li>
  <li>Kennis van shell/terminal-opdrachten</li>
  <li>De mogelijkheid om SQL-zoekopdrachten uit te voeren in de database.</li>
</ul>
<h3>Wat u gaat doen:</h3>

<div class="action">
<p>Deze stap bestaat uit drie gedeeltes:</p>
<ul>
  <li><a href="#preparation">Voorbereiding</a></li>
  <li><a href="#investigation">Onderzoek naar specifieke malware-infecties</a></li>
  <li><a href="#assessment">Algemene beoordeling van de schade aan het bestandssysteem</a></li>
</ul>
</div>

<a name="preparation"></a>
<h3>Voorbereiding</h3>
<ol>
  <li>Gebruik geen browser om pagina's op uw site weer te geven. Omdat malware zich vaak verspreidt door misbruik te maken van kwetsbaarheden van de browser, kunt u uw computer beschadigen als u een geïnfecteerde malwarepagina in een browser opent.</li>
  <li>Maak een document waarin u de bevindingen van deze stap vastlegt. Dit document bevat uiteindelijk (ten minste) de naam/locatie van elk beschadigd bestand met opmerkingen over de mate waarin het bestand is beschadigd. Dit document dient als basis voor <a href="clean_site">Uw site schoonmaken en bijhouden</a>.</li>
  <li>Bekijk indien nodig extra bronnen:
    <ul>
      <li>Bekijk de video hierboven om te zien hoe malware werkt en hoe u uzelf beschermt tijdens uw onderzoek naar malware.</li>
      <li>Bekijk de diagnostische pagina <a href="/safe-browsing/">Google Safe Browsing</a> voor algemeen beschikbare informatie over het mogelijke gevaar van een site voor gebruikers. U kunt de status van uw site opzoeken in een lijst via een URL die er vergelijkbaar uitziet als:
      <pre>http://www.google.com/safebrowsing/diagnostic?site=&lt;your-site&gt;</pre>
      Bijvoorbeeld:
      <code>http://www.google.com/safebrowsing/diagnostic?site=webmastercentralblog.blogspot.com</code></li>
    </ul>
  </li>
  <li>Gebruik <a href="https://www.google.com/search?q=cURL">cURL</a> of <a href="https://www.google.com/search?q=Wget">Wget</a> om HTTP-verzoeken uit te voeren (bijvoorbeeld om een pagina op te halen).
    <p>Deze gratis beschikbare tools zijn nuttig bij de diagnose van omleidingen en kunnen tevens informatie verstrekken over de verwijzende URL of user-agent. Het is nuttig om een specifieke verwijzende URL of user-agent toe te voegen om hackers na te bootsen. Sommige hackers versturen namelijk schadelijke content alleen naar gebruikers met specifieke user-agents of verwijzende URL's om meer 'echte' mensen te targeten en te voorkomen dat ze door site-eigenaren en malwarescanners worden ontdekt.</p>
    <pre>$curl -v --referer "http://www.google.com" &lt;your-url&gt;</pre></li>
</ol>

<a name="investigation"></a>
<h3>Onderzoek van specifieke malware-infectie op uw site</h3>
<ol>
  <li>Selecteer uw geverifieerde site in Search Console en klik op <strong>Beveiligingsproblemen</strong>.</li>
  <li> Onderzoek alle categorieën malware (bijvoorbeeld serverconfiguratie, invoeging van SQL) die in 'Beveiligingsproblemen' bij uw site staan vermeld. Klik op 'Details weergeven' voor meer informatie over geïnfecteerde URL's per categorie. (Details kunnen fragmenten bevatten van code die de hacker heeft ingevoegd.) Kopieer voor elke categorie de volgende elementen naar uw onderzoeksdocument:
    <ul>
      <li>Alle voorbeelden van geïnfecteerde URL's voor de malwarecategorie in Beveiligingsproblemen.</li>
      <li>Alle andere beschadigde pagina's die u tijdens uw onderzoek aantreft.</li>
      <li>Gedetailleerde bevindingen over de geïnfecteerde URL's, zoals het type schade.</li>
    </ul>
  </li>
  <li>Hieronder vindt u informatie die u bij het onderzoek naar elke malwarecategorie kan helpen:
    <ul>
      <li><a href="https://www.support.google.com/webmasters/answer/3024318">Serverconfiguratie</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024309">SQL-invoeging</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024381">Foutsjabloon</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024344">Invoeging van code</a></li>
    </ul>
  </li>
</ol>

<a name="assessment"></a>
<h4>Beoordelen van de schade aan het bestandssysteem</h4>
        <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="2A4dLkXXUjo" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<p>Log vervolgens in op het bestandssysteem van uw site voor diepgaander onderzoek. De hacker kan onder andere bestaande pagina's of databaserecords hebben gewijzigd, geheel nieuwe pagina's met spam hebben gemaakt, functies hebben geschreven waardoor op schone pagina's spam wordt weergegeven, 'achterdeuren' hebben gemaakt waardoor de hacker toegang heeft tot uw site, of waardoor schadelijke taken worden uitgevoerd totdat deze 'achterdeuren' worden verwijderd.</p>
<p>Als uw site online is, kunt u deze voor de volgende stap weer offline halen.</p>
<ol>
  <li>Als u over een goede back-up van uw site beschikt, kunt u bestanden vergelijken om te bepalen welke bestanden sinds de back-up zijn gemaakt of gewijzigd. Voeg deze bestanden aan uw lijst toe, omdat u deze waarschijnlijk nader wilt onderzoeken. Gebruik op Unix-systemen een opdracht zoals:
  <pre>$ diff -qr &lt;current-directory&gt; &lt;backup-directory&gt;</pre>
  Bijvoorbeeld:
  <pre>$ diff -qr www/ backups/full-backup-20120124/</pre>
  Het volgende kan ook:
  <pre>$ md5sum &lt;current-page&gt; &lt;backup-page&gt;</pre>
  Bijvoorbeeld:
  <pre>$ md5sum www/page.html backups/full-backup-20120124/page.html</pre></li>
  <li>Controleer de logbestanden voor de <strong>server, toegang en foutmeldingen</strong> op verdachte activiteiten, zoals mislukte inlogpogingen, de opdrachtgeschiedenis (met name die van de root), het maken van onbekende gebruikersaccounts, enzovoort. De hacker kan deze logbestanden voor zijn eigen doeleinden hebben gewijzigd. (Voorbeelden zijn te zien in de video voor <a href="vulnerability">Het beveiligingsprobleem identificeren</a>.)</li>
  <li>Controleer <strong>configuratiebestanden</strong>, zoals .htaccess en httpd.conf, op omleidingen.
    Hackers maken vaak voorwaardelijke omleidingen op basis van de user-agent, tijd van de dag of verwijzende URL.</li>
  <li>Controleer op te soepele toegangsrechten voor mappen en bestanden. Hackers passen toegangsrechten vaak aan. Als de site-eigenaar de soepele toegangsrechten niet ontdekt, kan de hacker altijd opnieuw inbreken op de site. Bestanden met een waarde groter dan 644 (rw-r--r--) en mappen met een waarde groter dan 755 (rwxr-xr-x) kunnen beveiligingsrisico's met zich meebrengen. Controleer of alle mildere toegangsrechten echt noodzakelijk zijn. Als uw systeem Unix gebruikt, typt u:
  <pre>$ find &lt;your-dir&gt; -type d -not -perm 755 -exec ls -ld {} \;</pre>
  <pre>$ find &lt;your-dir&gt; -type f -not -perm 644 -exec ls -la {} \;</pre></li>
  <li>Gebruik voor databases een tool als <a href="https://www.phpmyadmin.net/home_page/index.php">phpMyAdmin</a> om record voor record te onderzoeken.</li>
</ol>

<h2>Volgende stap</h2>
<p>De volgende stap in het proces is <a href="vulnerability">Het beveiligingsprobleem identificeren</a>.</p>

</body></html>
