<html devsite><head>
  <title>Compromissione con malware</title>
  <meta name="project_path" value="/web/fundamentals/_project.yaml"/>
  <meta name="book_path" value="/web/fundamentals/_book.yaml"/>
</head>
  <body>
<p>Questo passaggio riguarda i siti compromessi allo scopo di distribuire malware, spesso mostrati nei risultati di ricerca insieme all'avviso <em>"Questo sito potrebbe danneggiare il tuo computer"</em>. Si tratta di uno dei passaggi più lunghi del processo di ripristino e consiste nel compilare un elenco dei file danneggiati del tuo sito.
  Questo elenco verrà poi utilizzato in un passaggio successivo, <a href="clean_site">Ripulisci e gestisci il sito</a>.</p>
  <p>Se nel tuo sito è stato inserito spam e non malware e nei risultati di ricerca viene mostrato l'avviso <em>"Il sito potrebbe essere compromesso"</em>, consulta la pagina <a href="hacked_with_spam">Valuta il danno (spam)</a>.</p>

    <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="Snt45fZQIiU" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<h3>Requisiti:</h3>
<ul>
  <li>Accesso come amministratore di shell/terminale ai server del sito: Web, database, file.</li>
  <li>Conoscenza dei comandi di shell/terminale.</li>
  <li>Possibilità di eseguire query SQL nel database.</li>
</ul>
<h3>Operazioni da eseguire:</h3>

<div class="action">
<p>Questo passaggio è costituito da tre sezioni:</p>
<ul>
  <li><a href="#preparation">Preparazione</a></li>
  <li><a href="#investigation">Indagine dei tipi specifici di infezione da malware</a></li>
  <li><a href="#assessment">Valutazione del danno complessivo al file system</a></li>
</ul>
</div>

<a name="preparation"></a>
<h3>Preparazione</h3>
<ol>
  <li>Evita di utilizzare un browser per visualizzare le pagine del tuo sito. Poiché il malware si diffonde spesso sfruttando le vulnerabilità del browser, l'apertura di una pagina di malware infetta in un browser potrebbe danneggiare il computer.</li>
  <li>Crea un documento in cui registrare le informazioni ricavate con questo passaggio. Il documento alla fine comprenderà (come minimo) il nome/percorso di ogni file danneggiato e note su come è stato infettato; servirà inoltre come base per il passaggio <a href="clean_site">Ripulisci e gestisci il sito</a>.</li>
  <li>Se necessario, controlla altre risorse:
    <ul>
      <li>Guarda il video riportato sopra per comprendere come funziona il malware e come mantenere la sicurezza durante la relativa indagine.</li>
      <li>Visualizza la <a href="/safe-browsing/">pagina di diagnostica Navigazione sicura di Google</a> per informazioni pubbliche sul potenziale danno per gli utenti derivante dal sito. Puoi visualizzare lo stato dell'elenco del tuo sito in un URL simile al seguente:
      <pre>http://www.google.com/safebrowsing/diagnostic?site=&lt;your-site&gt;</pre>
      Ad esempio: <code>http://www.google.com/safebrowsing/diagnostic?site=webmastercentralblog.blogspot.com</code></li>
    </ul>
  </li>
  <li>Utilizza <a href="https://www.google.com/search?q=cURL">cURL</a> o <a href="https://www.google.com/search?q=Wget">Wget</a> per eseguire richieste HTTP (ad esempio, per recuperare una pagina).
    <p>Questi strumenti disponibili gratuitamente sono utili nella diagnosi dei reindirizzamenti e dispongono della flessibilità necessaria per includere le informazioni sui referrer o sullo user-agent. L'inserimento di un referrer o di uno user-agent specifico è utile per simulare gli hacker, poiché questi ultimi possono solamente pubblicare contenuti dannosi per gli utenti con user-agent o referrer specifici, allo scopo di raggiungere un numero maggiore di "utenti reali" evitando il rilevamento da parte dei proprietari dei siti e degli scanner di malware.</p>
    <pre>$curl -v --referer "http://www.google.com" &lt;your-url&gt;</pre></li>
</ol>

<a name="investigation"></a>
<h3>Indagine su specifici tipi di infezione da malware nel tuo sito</h3>
<ol>
  <li>Seleziona il tuo sito verificato in Search Console, quindi fai clic su <strong>Problemi di sicurezza</strong>.</li>
  <li> Esamina tutte le categorie di malware (ad esempio, la configurazione del server, l'iniezione SQL) elencate in Problemi di sicurezza del tuo sito. Puoi trovare ulteriori informazioni sugli URL infetti della categoria facendo clic su "Mostra dettagli". I dettagli possono includere esempi di snippet di codice inseriti dall'hacker. Per ogni categoria, copia nel documento di indagine:
    <ul>
      <li>Tutti gli URL infetti d'esempio elencati per categoria di malware in Problemi di sicurezza.</li>
      <li>Eventuali altre pagine compromesse individuate durante l'indagine.</li>
      <li>Risultati dettagliati sugli URL infetti, come il tipo di danno causato.</li>
    </ul>
  </li>
  <li>Le informazioni per agevolare le indagini per ogni tipo di malware sono elencate di seguito:
    <ul>
      <li><a href="https://www.support.google.com/webmasters/answer/3024318">Configurazione del server</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024309">Iniezione SQL</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024381">Modello di errore</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024344">Iniezione di codice</a></li>
    </ul>
  </li>
</ol>

<a name="assessment"></a>
<h4>Valutazione del danno al file system</h4>
        <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="2A4dLkXXUjo" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<p>A questo punto, devi accedere al file system del tuo sito per approfondire l'indagine. Tra le altre cose, tieni presente che l'hacker potrebbe aver modificato le pagine o i record di database esistenti, creato pagine contenenti spam completamente nuove, scritto funzioni per la visualizzazione di spam in pagine pulite o lasciato "ingressi secondari" che gli permetteranno di entrare di nuovo nel sito o che continueranno a eseguire attività dannose a meno che non vengano eliminati.</p>
<p>Se il tuo sito è online, per questo passaggio puoi portarlo di nuovo offline.</p>
<ol>
  <li>Se disponi di una copia di backup pulita del tuo sito, identifica i file che sono stati creati o modificati dopo il backup. Aggiungi questi file al tuo elenco perché, probabilmente, vorrai eseguire ulteriori indagini. Nei sistemi basati su Unix puoi utilizzare un comando come:
  <pre>$ diff -qr &lt;current-directory&gt; &lt;backup-directory&gt;</pre>
  Ad esempio:
  <pre>$ diff -qr www/ backups/full-backup-20120124/</pre>
  così come
  <pre>$ md5sum &lt;current-page&gt; &lt;backup-page&gt;</pre>
  Ad esempio:
  <pre>$ md5sum www/page.html backups/full-backup-20120124/page.html</pre></li>
  <li>Nei <strong>log del server, degli accessi e di errore</strong> cerca eventuali attività sospette quali, ad esempio, tentativi di accesso non riusciti, cronologia dei comandi (soprattutto come root), creazione di account utente sconosciuti e così via. Tieni presente che l'hacker potrebbe avere alterato questi log per i propri scopi. Se pensi che possa esserti utile, puoi trovare alcuni esempi nel video del passaggio <a href="vulnerability">Identifica la vulnerabilità</a>.</li>
  <li>Cerca nei <strong>file di configurazione</strong> quali, ad esempio, .htaccess e httpd.conf, eventuali reindirizzamenti.
    Gli hacker creano spesso reindirizzamenti condizionali in base allo user-agent, all'ora del giorno o al referrer.</li>
  <li>Controlla le autorizzazioni di cartelle e file troppo miti. Gli hacker manomettono le autorizzazioni perché, se le autorizzazioni troppo miti non vengono individuate dal proprietario del sito, l'hacker potrà entrare nuovamente nel sito. I file maggiori di 644 (rw-r--r--) e le cartelle superiori a 755 (rwxr-xr-x) possono causare problemi di sicurezza. Assicurati che le autorizzazioni più ampie siano davvero necessarie. Nei sistemi basati su Unix, prova con:
  <pre>$ find &lt;your-dir&gt; -type d -not -perm 755 -exec ls -ld {} \;</pre>
  <pre>$ find &lt;your-dir&gt; -type f -not -perm 644 -exec ls -la {} \;</pre></li>
  <li>Se disponi di un database, esamina record per record utilizzando uno strumento come <a href="https://www.phpmyadmin.net/home_page/index.php">phpMyAdmin</a>.</li>
</ol>

<h2>Passaggio successivo</h2>
<p>Procedi al passaggio <a href="vulnerability">Identifica la vulnerabilità</a>.</p>

</body></html>
