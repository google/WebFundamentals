<html devsite><head>
  <title>Sitio web pirateado con software malicioso</title>
  <meta name="project_path" value="/web/fundamentals/_project.yaml"/>
  <meta name="book_path" value="/web/fundamentals/_book.yaml"/>
</head>
  <body>
<p>Este paso se aplica a sitios web pirateados que propagan software malicioso y que, a menudo, muestran el mensaje de advertencia <em>"Este sitio puede dañar tu ordenador"</em> en los resultados de búsqueda. Es uno de los pasos más largos del proceso de recuperación.  En este paso compilaremos una lista con los archivos dañados del sitio web.
  Vamos a usar esta lista en un paso posterior, en <a href="clean_site">Limpiar el sitio web y hacer tareas de mantenimiento</a>.</p>
  <p>Si el sitio web se ha visto afectado por spam (no por software malicioso) y puedes leer el mensaje de advertencia "<em>Este sitio puede haber sido comprometido</em>" en los resultados de búsqueda, consulta la página <a href="hacked_with_spam">Evaluar los daños provocados por spam (sitio web pirateado con spam)</a>.</p>

    <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="Snt45fZQIiU" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<h3>Lo que necesitarás:</h3>
<ul>
  <li>Acceso de administrador de shell/terminal a los servidores del sitio (web, base de datos, archivos)</li>
  <li>Conocimientos de los comandos de shell/terminal</li>
  <li>Capacidad para ejecutar consultas SQL en la base de datos</li>
</ul>
<h3>Lo que debes hacer:</h3>

<div class="action">
<p>Este paso tiene tres secciones:</p>
<ul>
  <li><a href="#preparation">Preparación</a></li>
  <li><a href="#investigation">Investigación de tipos concretos de infección por software malicioso</a></li>
  <li><a href="#assessment">Evaluación de los daños en el sistema de archivos general</a></li>
</ul>
</div>

<a name="preparation"></a>
<h3>Preparación</h3>
<ol>
  <li>No accedas a las páginas del sitio web desde un navegador, ya que el software malicioso suele propagarse mediante la explotación de las vulnerabilidades del navegador. Si abres una página infectada por software malicioso con un navegador, el equipo puede sufrir daños.</li>
  <li>Crea un documento para registrar los resultados de este paso. El documento debe incluir (como mínimo) el nombre o la ubicación de cada archivo dañado y notas sobre cómo se infectó. Además, servirá de base para el paso <a href="clean_site">Limpiar el sitio web y hacer tareas de mantenimiento</a>.</li>
  <li>Consulta los recursos adicionales según sea necesario:
    <ul>
      <li>Ve el vídeo mencionado anteriormente para saber cómo funciona el software malicioso y cómo puedes permanecer seguro durante la investigación del software malicioso.</li>
      <li>Visita la <a href="/safe-browsing/">página de diagnóstico de Navegación segura de Google</a> para consultar la información pública sobre cuándo un sitio web es potencialmente dañino para los usuarios. Puedes ver la ficha del estado de tu sitio web en una dirección URL parecida a la siguiente:
      <pre>http://www.google.com/safebrowsing/diagnostic?site=&lt;your-site&gt;</pre>
      Por ejemplo:
<code>http://www.google.com/safebrowsing/diagnostic?site=webmastercentralblog.blogspot.com</code></li>
    </ul>
  </li>
  <li>Utiliza <a href="https://www.google.com/search?q=cURL">cURL</a> o<a href="https://www.google.com/search?q=Wget">Wget</a> para realizar solicitudes HTTP (por ejemplo, para explorar una página).
    <p>Estas herramientas de libre disposición son útiles en el diagnóstico de redireccionamientos y tienen la flexibilidad de incluir información de la URL de referencia o de user-agent. Es útil incluir una URL de referencia o un user-agent específicos para imitar a los hackers, que es posible que solo sirvan contenido malicioso a usuarios con user-agent o URLs de referencia específicos para llegar a más "gente real" y así poder evitar que los propietarios de sitios web y los escáneres de software malicioso los detecten.</p>
    <pre>$curl -v --referer "http://www.google.com" &lt;your-url&gt;</pre></li>
</ol>

<a name="investigation"></a>
<h3>Investigación de tipos específicos de infección de software malicioso en tu sitio web</h3>
<ol>
  <li>Selecciona tu sitio web verificado en Search Console y, a continuación, haz clic en <strong>Problemas de seguridad</strong>.</li>
  <li> Investiga todas las categorías de software malicioso (por ejemplo, configuración del servidor, inyección de SQL) que se muestran en la sección Problemas de seguridad de tu sitio web. Para obtener más información sobre las URL infectadas, haz clic en "Mostrar detalles". Es posible que en dichos detalles se incluyan muestras de fragmentos de código que el hacker haya inyectado. Para cada categoría, copia en el documento de investigación la información siguiente:
    <ul>
      <li>Todos los ejemplos de URL infectadas que aparecen en la categoría de software malicioso en "Problemas de seguridad".</li>
      <li>Las páginas dañadas adicionales que descubras durante la investigación.</li>
      <li>Conclusiones detalladas de las URL infectadas, como el tipo de daño causado.</li>
    </ul>
  </li>
  <li>A continuación, encontrarás información de ayuda para la investigación de cada tipo de software malicioso:
    <ul>
      <li><a href="https://www.support.google.com/webmasters/answer/3024318">Configuración del servidor</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024309">Inyección de SQL</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024381">Plantilla de errores</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024344">Inyección de código</a></li>
    </ul>
  </li>
</ol>

<a name="assessment"></a>
<h4>Evaluación de daños del sistema de archivos</h4>
        <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="2A4dLkXXUjo" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<p>A continuación, debes iniciar sesión en el sistema de archivos de tu sitio web para llevar a cabo una investigación más precisa. Es posible que, entre otras cosas, el hacker haya modificado los registros de páginas o de la base de datos, haya creado páginas con contenido fraudulento totalmente nuevas, haya escrito funciones para mostrar spam en páginas limpias o haya dejado "puertas abiertas" que le permitan volver a tu sitio web o continuar realizando tareas maliciosas si no se eliminan.</p>
<p>Si tu sitio web está online, puedes retirarlo para este paso.</p>
<ol>
  <li>Si tienes una copia de seguridad limpia de tu sitio web, identifica los archivos que se hayan creado o modificado después de crear la copia de seguridad. Añade estos archivos a tu lista por si necesitas investigarlos más a fondo. En los sistemas basados en Unix, puedes utilizar un comando como:
  <pre>$ diff -qr &lt;current-directory&gt; &lt;backup-directory&gt;</pre>
  Por ejemplo:
  <pre>$ diff -qr www/ backups/full-backup-20120124/</pre>
  Y también:
  <pre>$ md5sum &lt;current-page&gt; &lt;backup-page&gt;</pre>
  Por ejemplo:
  <pre>$ md5sum www/page.html backups/full-backup-20120124/page.html</pre></li>
  <li>Busca actividades sospechosas en los <strong>registros del servidor, de acceso y de errores</strong>, por ejemplo, errores al intentar iniciar sesión, el historial de comandos (sobre todo como root), la creación de cuentas de usuario desconocidas, etc. Es posible que el hacker haya alterado los registros para sus propios fines. En el vídeo sobre cómo <a href="vulnerability">identificar la vulnerabilidad</a> se muestran algunos ejemplos que te pueden ser útiles.</li>
  <li>Comprueba si los <strong>archivos de configuración</strong>, como .htaccess y httpd.conf, tienen redireccionamientos.
    Los hackers suelen crear redireccionamientos condicionales basados en el user-agent, el momento del día o la URL de referencia.</li>
  <li>Comprueba si hay permisos de carpetas y de archivos demasiado laxos. Los hackers manipulan los permisos porque, si el propietario del sitio web no los detecta, el hacker tendrá una manera de volver a entrar en el sitio web. Los archivos con permisos superiores a 644 (rw-r-r-) y las carpetas con permisos superiores a 755 (rwxr-xr-x) pueden causar problemas de seguridad. Asegúrate de que los permisos más flexibles sean realmente necesarios. En los sistemas basados en Unix, prueba lo siguiente:
  <pre>$ find &lt;your-dir&gt; -type d -not -perm 755 -exec ls -ld {} \;</pre>
  <pre>$ find &lt;your-dir&gt; -type f -not -perm 644 -exec ls -la {} \;</pre></li>
  <li>Si tienes una base de datos, investiga los registros uno a uno con una herramienta como <a href="https://www.phpmyadmin.net/home_page/index.php">phpMyAdmin</a>.</li>
</ol>

<h2>Paso siguiente</h2>
<p>La siguiente fase del proceso es <a href="vulnerability">identificar la vulnerabilidad</a>.</p>

</body></html>
