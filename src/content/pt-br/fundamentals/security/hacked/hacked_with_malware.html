<html devsite><head>
  <title>Invasão com malware</title>
  <meta name="project_path" value="/web/fundamentals/_project.yaml"/>
  <meta name="book_path" value="/web/fundamentals/_book.yaml"/>
</head>
  <body>
<p>Esta etapa refere-se a sites invadidos para distribuir malware, muitas vezes com o aviso <em>"Este site
  pode danificar seu computador"</em> exibido nos resultados da pesquisa. É uma das etapas mais longas no
  processo de recuperação.  Nesta etapa, você compilará uma lista de arquivos danificados em seu site.
  Você usará essa lista em uma etapa posterior, <a href="clean_site">Fazer a limpeza e a manutenção de seu
  site</a>.</p>
  <p>Se o site tiver sido afetado por spam, não malware, e exibir o aviso <em>"Este site pode ter sido invadido"</em> nos resultados da pesquisa, consulte a página sobre como <a href="hacked_with_spam">avaliar danos de spam (invasão por spam)</a>.</p>

    <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="Snt45fZQIiU" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<h3>Será necessário:</h3>
<ul>
  <li>Acesso de administrador shell/de terminal aos servidores de seu site: Web, banco de dados, arquivos.</li>
  <li>Conhecimento de comandos shell/de terminal.</li>
  <li>Capacidade de executar consultas SQL no banco de dados.</li>
</ul>
<h3>O que você fará:</h3>

<div class="action">
<p>Esta etapa tem três seções:</p>
<ul>
  <li><a href="#preparation">Preparação</a></li>
  <li><a href="#investigation">Investigação de tipos de infecção específicos de malware</a></li>
  <li><a href="#assessment">Avaliação geral dos danos ao sistema de arquivos</a></li>
</ul>
</div>

<a name="preparation"></a>
<h3>Preparação</h3>
<ol>
  <li>Evite usar um navegador para visualizar páginas em seu site. Como muitas vezes o malware se espalha explorando
    vulnerabilidades do navegador, abrir uma página infectada com malware em um navegador pode danificar seu
    computador.</li>
  <li>Crie um documento para registrar os resultados desta etapa. O documento incluirá (no mínimo) o nome ou o local de cada arquivo danificado e observações sobre como ele foi infectado. Isso servirá como base para a <a href="clean_site">fazer a limpeza e a manutenção do seu site</a>.</li>
  <li>Confira os recursos adicionais, se necessário:
    <ul>
      <li>Assista o vídeo acima para ver como o malware funciona e como é possível manter-se em segurança durante a
        investigação em busca de malware.</li>
      <li>Consulte a <a href="/safe-browsing/">página de diagnóstico de Navegação
        segura do Google</a> para ver informações públicas sobre a possibilidade de um site causar danos
        aos usuários. É possível ver o status de listagem do seu site em um URL semelhante ao seguinte:
      <pre>http://www.google.com/safebrowsing/diagnostic?site=&lt;your-site&gt;</pre>
      Por exemplo:
      <code>http://www.google.com/safebrowsing/diagnostic?site=webmastercentralblog.blogspot.com</code></li>
    </ul>
  </li>
  <li>Use <a href="https://www.google.com/search?q=cURL">cURL</a> ou <a href="https://www.google.com/search?q=Wget">Wget</a> para fazer solicitações HTTP (por exemplo, para buscar uma página).
    <p>Estas ferramentas disponíveis gratuitamente são úteis para diagnosticar redirecionamentos e têm a flexibilidade
      de incluir informações do referenciador ou de user agent. Incluir um referenciador ou user agent específico
      é útil para imitar os hackers, pois eles só podem veicular conteúdo malicioso para usuários com
      user agents ou referenciadores específicos, para atingir mais "pessoas reais" e também podem evitar a detecção por
      parte dos proprietários do site e de scanners de malware.</p>
    <pre>$curl -v --referer "http://www.google.com" &lt;your-url&gt;</pre></li>
</ol>

<a name="investigation"></a>
<h3>Estudo dos tipos específicos de infecção de malware em seu site</h3>
<ol>
  <li>Selecione seu site verificado no Search Console e clique em <strong>Problemas de segurança</strong>.</li>
  <li> Investigue todas as categorias de malware listadas nos problemas de segurança do seu site, como configuração do servidor e injeção de SQL. Cliquem em "Exibir detalhes" para ver informações adicionais sobre os URLs infectados de cada categoria. Os detalhes podem incluir exemplos de snippets de código injetados pelo hacker. Para cada categoria, copie para o documento de investigação:
    <ul>
      <li>Todos os URLs de exemplo infectados listados na categoria de malware em Problemas de segurança.</li>
      <li>Todas as páginas adicionais danificadas que forem descobertas durante sua investigação.</li>
      <li>Resultados detalhados sobre os URLs infectados, como o tipo de dano causado.</li>
    </ul>
  </li>
  <li>Abaixo você encontra informações para ajudar a investigar cada tipo de malware:
    <ul>
      <li><a href="https://www.support.google.com/webmasters/answer/3024318">Configuração do servidor</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024309">Injeção de SQL</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024381">Modelo de erro</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024344">Injeção de código</a></li>
    </ul>
  </li>
</ol>

<a name="assessment"></a>
<h4>Avaliação de danos ao sistema de arquivos</h4>
        <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="2A4dLkXXUjo" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<p>Em seguida, será preciso fazer login no sistema de arquivos do site para mais uma investigação aprofundada. Esteja ciente
  de que, entre outras coisas, o hacker pode ter modificado páginas ou registros de banco de dados existentes,
  criado novas páginas com spam, gravado funções para a exibição de spam em páginas limpas ou deixado
  "backdoors", que permitirão uma nova entrada do hacker no site ou que continuarão a execução
  de tarefas mal-intencionadas caso não sejam eliminados.</p>
<p>Caso seu site esteja on-line, deixe-o novamente como off-line nesta etapa.</p>
<ol>
  <li>Se você tem um bom backup do site, identifique os arquivos que foram criados ou
    modificados desde o backup. Adicione esses arquivos à sua lista, pois você provavelmente desejará investigar
    mais. Em sistemas baseados em Unix, use um comando como:
  <pre>$ diff -qr &lt;current-directory&gt; &lt;backup-directory&gt;</pre>
  Por exemplo:
  <pre>$ diff -qr www/ backups/full-backup-20120124/</pre>
  além disso,
  <pre>$ md5sum &lt;current-page&gt; &lt;backup-page&gt;</pre>
  Por exemplo:
  <pre>$ md5sum www/page.html backups/full-backup-20120124/page.html</pre></li>
  <li>Verifique se os <strong>registros de servidor, acesso e erros</strong> apresentam atividades suspeitas, como
    tentativas de login com falha, histórico de comandos (especialmente como raiz), criação de contas de usuários
    desconhecidos e assim por diante. Esteja ciente de que o hacker pode ter alterado esses registros de acordo com os
    propósitos dele. Caso seja útil, veja o vídeo com exemplos para
    <a href="vulnerability">identificar a vulnerabilidade</a>.</li>
  <li>Confira <strong>arquivos de configuração</strong>, como .htaccess e httpd.conf, em busca de redirecionamentos.
    Os hackers frequentemente criam redirecionamentos condicionais com base no user agent, na hora do dia ou no referenciador.</li>
  <li>Verifique se há pastas e permissões de arquivo muito brandas. Os hackers alteram as permissões porque, quando
    as permissões muito brandas permanecem despercebidas pelo proprietário do site, o hacker tem uma maneira de entrar
    no site novamente. Arquivos maiores que 644 (rw-r--r--) e pastas superiores a 755 (rwxr-xr-x) podem causar
    problemas de segurança. Certifique-se de que todas as permissões mais abrangentes são realmente necessárias. Em sistemas Unix, experimente:
  <pre>$ find &lt;your-dir&gt; -type d -not -perm 755 -exec ls -ld {} \;</pre>
  <pre>$ find &lt;your-dir&gt; -type f -not -perm 644 -exec ls -la {} \;</pre></li>
  <li>Se você tiver um banco de dados, investigue registro por registro usando uma ferramenta como
    <a href="https://www.phpmyadmin.net/home_page/index.php">phpMyAdmin</a>.</li>
</ol>

<h2>Próxima etapa</h2>
<p>A próxima etapa do processo é <a href="vulnerability">identificar a vulnerabilidade</a>.</p>

</body></html>
