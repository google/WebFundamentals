<html devsite><head>
  <title>Piratage de type logiciel malveillant</title>
  <meta name="project_path" value="/web/fundamentals/_project.yaml"/>
  <meta name="book_path" value="/web/fundamentals/_book.yaml"/>
</head>
  <body>
<p>Cette étape concerne les sites piratés pour distribuer des logiciels malveillants, qui s'accompagnent souvent d'un avertissement <em>Ce site risque d'endommager votre ordinateur</em> dans les résultats de recherche. Il s'agit de l'une des étapes les plus longues du processus de récupération.  Au cours de cette étape, vous allez établir la liste des fichiers endommagés présents sur votre site.
  Cette liste vous sera nécessaire au cours d'une étape ultérieure, <a href="clean_site">Nettoyer votre site et en assurer la maintenance</a>.</p>
  <p>Si votre site a été affecté par du spam, et non par un logiciel malveillant, et que l'avertissement <em>Il est possible que ce site ait été piraté</em> s'affiche dans les résultats de recherche, veuillez vous reporter à la page <a href="hacked_with_spam">Évaluer les dommages (Piratage de type spam)</a>.</p>

    <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="Snt45fZQIiU" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<h3>Vous aurez besoin :</h3>
<ul>
  <li>d'un accès aux serveurs de votre site (Web, base de données, fichiers) en tant qu'administrateur du shell/du terminal ;</li>
  <li>d'une bonne connaissance des commandes du shell/du terminal ;</li>
  <li>d'effectuer des requêtes SQL dans la base de données.</li>
</ul>
<h3>Ce que vous allez devoir faire :</h3>

<div class="action">
<p>Cette étape comporte trois sections :</p>
<ul>
  <li><a href="#preparation">Préparation</a></li>
  <li><a href="#investigation">Examen de types spécifiques d'infection par des logiciels malveillants</a></li>
  <li><a href="#assessment">Évaluation générale des dommages sur le système de fichiers</a></li>
</ul>
</div>

<a name="preparation"></a>
<h3>Préparation</h3>
<ol>
  <li>Évitez d'utiliser un navigateur pour afficher des pages de votre site. Étant donné que les logiciels malveillants se propagent souvent en exploitant les failles des navigateurs, ouvrir une page infectée par un logiciel malveillant dans un navigateur peut endommager votre ordinateur.</li>
  <li>Créez un document pour enregistrer les résultats de cette étape. Le document comprendra à la fin (au minimum) le nom/l'emplacement de chaque fichier endommagé ainsi que des notes sur la façon dont il a été infecté. Il servira de base à l'étape <a href="clean_site">Nettoyer votre site et en assurer la maintenance</a>.</li>
  <li>Consultez des ressources supplémentaires si nécessaire :
    <ul>
      <li>Regardez la vidéo ci-dessus pour comprendre le fonctionnement des logiciels malveillants et savoir comment vous protéger lors de votre recherche de logiciels malveillants.</li>
      <li>Consultez la page de <a href="/safe-browsing/">diagnostic de la navigation sécurisée Google</a> pour accéder à des informations publiques concernant le danger que représente un site pour les internautes. Vous pouvez consulter l'état de votre site à l'aide d'une URL semblable à celle-ci :
      <pre>http://www.google.com/safebrowsing/diagnostic?site=&lt;your-site&gt;</pre>
      Il peut s'agir par exemple de <code>http://www.google.com/safebrowsing/diagnostic?site=webmastercentralblog.blogspot.com</code>.</li>
    </ul>
  </li>
  <li>Utilisez la <a href="https://www.google.com/search?q=cURL">commande cURL</a> ou la <a href="https://www.google.com/search?q=Wget">commande Wget</a> afin d'effectuer des requêtes HTTP (pour explorer une page par exemple).
    <p>Ces outils disponibles gratuitement sont utiles pour diagnostiquer les URL de redirection. Ils peuvent comprendre des informations concernant les URL de provenance ou les user-agents. L'intégration de ces données permet de simuler les actions effectuées par les pirates informatiques. En effet, ces derniers peuvent choisir de n'afficher du contenu malveillant que pour les internautes utilisant des user-agents ou des URL de provenance spécifiques. Cela leur permet de cibler plus de "personnes réelles" et de ne pas être repérés par les propriétaires de sites ni par les détecteurs de logiciels malveillants.</p>
    <pre>$curl -v --referer "http://www.google.com" &lt;your-url&gt;</pre></li>
</ol>

<a name="investigation"></a>
<h3>Recherche de types spécifiques d'infections de votre site par des logiciels malveillants</h3>
<ol>
  <li>Sélectionnez votre site validé dans la Search Console, puis cliquez sur <strong>Problèmes de sécurité</strong>.</li>
  <li> Examinez toutes les catégories de logiciels malveillants (par exemple : configuration de serveur, injection SQL) affichées sur la page "Problèmes de sécurité" pour votre site. Vous pouvez consulter des informations supplémentaires sur les URL infectées de la catégorie en cliquant sur "Afficher les détails". Les détails peuvent inclure des extraits de code injecté par le pirate informatique. Pour chaque catégorie, copiez les éléments suivants dans votre document d'examen :
    <ul>
      <li>Tous les exemples d'URL infectées affichés pour la catégorie de logiciels malveillants de la page "Problèmes de sécurité"</li>
      <li>Toute page endommagée supplémentaire que vous pourriez trouver lors de votre examen</li>
      <li>Les résultats détaillés obtenus à propos des URL infectées, tels que le type de dommage causé</li>
    </ul>
  </li>
  <li>Vous trouverez des informations supplémentaires pour vous aider à examiner chaque catégorie de logiciels malveillants dans les sections mentionnées ci-dessous :
    <ul>
      <li><a href="https://www.support.google.com/webmasters/answer/3024318">Configuration du serveur</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024309">Injection SQL</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024381">Modèle d'erreur</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024344">Injection de code</a></li>
    </ul>
  </li>
</ol>

<a name="assessment"></a>
<h4>Évaluation des dommages sur le système de fichiers</h4>
        <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="2A4dLkXXUjo" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<p>Vous aurez ensuite besoin de vous connecter au système de fichiers de votre site pour procéder à un examen plus approfondi. Sachez que le pirate informatique peut, entre autres, avoir modifié des pages ou des enregistrements de base de données, créé des pages contenant du spam, écrit des fonctions pour afficher du spam sur des pages saines ou laissé des "portes dérobées" qui lui permettront de revenir sur votre site, ou qui continueront d'effectuer des tâches malveillantes si elles ne sont pas supprimées.</p>
<p>Si votre site est en ligne, vous pouvez le retirer du Web pour effectuer cette étape.</p>
<ol>
  <li>Si vous possédez une sauvegarde de votre site que vous pensez non infectée, déterminez les fichiers qui ont été créés ou modifiés depuis la sauvegarde. Ajoutez ces fichiers à votre liste, car vous devrez probablement les examiner plus en détail. Sur les systèmes d'exploitation Unix, vous pouvez utiliser une commande telle que :
  <pre>$ diff -qr &lt;current-directory&gt; &lt;backup-directory&gt;</pre>
  Par exemple :
  <pre>$ diff -qr www/ backups/full-backup-20120124/</pre>
  ou également
  <pre>$ md5sum &lt;current-page&gt; &lt;backup-page&gt;</pre>
  Par exemple :
  <pre>$ md5sum www/page.html backups/full-backup-20120124/page.html</pre></li>
  <li>Vérifiez que les <strong>journaux de serveur, d'accès et d'erreurs</strong> ne comportent aucune activité suspecte, telle que des échecs de tentative de connexion, un historique de commandes (root, en particulier), la création de comptes utilisateur inconnus et autres. Sachez que le pirate peut avoir modifié ces journaux à ses propres fins. Si cela peut vous aider, la vidéo de l'étape <a href="vulnerability">Identifier la faille</a> présente quelques exemples.</li>
  <li>Vérifiez que les <strong>fichiers de configuration</strong>, tels que les fichiers .htaccess et httpd.conf, ne comportent aucune URL de redirection.
    Les pirates informatiques créent souvent des URL de redirection conditionnelles basées sur le user-agent, l'heure de la journée ou l'URL de provenance.</li>
  <li>Vérifiez que les autorisations relatives aux dossiers et aux fichiers ne sont pas trop larges. Les pirates informatiques s'y attaquent souvent. Si les autorisations sont trop larges et que le propriétaire du site ne s'en rend pas compte, la personne malveillante peut s'en servir pour revenir sur ce dernier. Des fichiers avec une autorisation supérieure à 644 (rw-r--r--) et des dossiers avec une autorisation supérieure à 755 (rwxr-xr-x) peuvent engendrer des problèmes de sécurité. Assurez-vous que toute autorisation plus large est vraiment nécessaire. Pour les systèmes d'exploitation Unix, essayez :
  <pre>$ find &lt;your-dir&gt; -type d -not -perm 755 -exec ls -ld {} \;</pre>
  <pre>$ find &lt;your-dir&gt; -type f -not -perm 644 -exec ls -la {} \;</pre></li>
  <li>Si vous possédez une base de données, examinez les enregistrements un par un à l'aide d'un <a href="https://www.phpmyadmin.net/home_page/index.php">outil tel que phpMyAdmin</a>.</li>
</ol>

<h2>Étape suivante</h2>
<p>L'étape suivante du processus consiste à <a href="vulnerability">identifier la faille</a>.</p>

</body></html>
