<html devsite><head>
  <title>تنظيف الموقع وصيانته</title>
  <meta name="project_path" value="/web/fundamentals/_project.yaml"/>
  <meta name="book_path" value="/web/fundamentals/_book.yaml"/>
</head>
  <body>
<h3>ستحتاج إلى ما يلي:</h3>

<ul>
  <li>إمكانية دخول مشرف Shell/طرفي إلى خوادم الموقع: الويب وقواعد البيانات والملفات</li>
  <li>معرفة بأوامر shell/الطرفية</li>
  <li>استيعاب الشفرة (مثل PHP أو جافا سكريبت)</li>
  <li>سعة تخزينية لإنشاء نسخ احتياطية من موقعك (بما في ذلك الملفات وقاعدة البيانات والصور وما إلى ذلك)</li>
</ul>
    <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="OAvydrgDa6Q" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<h3>الإجراءات التالية:</h3>

<p>سنتناول عدة إجراءات في هذه الخطوة: </p>

<ul>
  <li>كيفية الحصول على مصادر إضافية إذا كنت تعتقد أن المخترق كان يريد الحصول على معلومات شخصية حول المستخدمين (كما هو الحال في صفحات التصيد الاحتيالي)</li>
  <li>خيار استخدام <a href="https://www.google.com/webmasters/tools/removals">إزالة عناوين URL</a> في Search Console لتسريع إزالة عناوين URL الجديدة وغير المرغوب فيها تمامًا والتي تكون مرئية للمستخدم وينشئها المخترق ولا تريدها أن تظهر ضمن نتائج بحث Google</li>
  <li>خيار استخدام <a href="https://www.support.google.com/webmasters/answer/1352276">الجلب مثل Google</a> في Search Console لتسريع معالجة Google للصفحات النظيفة - الصفحات التي تكون إما جديدة أو تم تحديثها مؤخرًا - والتي تريدها أن تظهر ضمن نتائج بحث Google</li>
  <li>تثبيت أحدث إصدار آمن من البرامج</li>
  <li>إزالة التطبيقات أو المكوِّنات الإضافية غير الضرورية وغير المستخدمة التي قد تجعل موقعك عرضة للخطر في المستقبل</li>
  <li>استعادة المحتوى الجيد وإزالة المحتوى الذي وضعه المخترق</li>
  <li>إصلاح نقطة الضعف الأساسية التي استغلها المخترق</li>
  <li>تغيير جميع كلمات المرور</li>
  <li>التخطيط للحفاظ على أمان الموقع</li>
</ul>

<h4>1- البحث عن مصادر الدعم عند التعامل مع حالة فقد معلومات سرية، كما هو الحال في صفحات التصيد الاحتيالي</h4>

<p>إذا تم الحصول على معلومات سرية عن المستخدم من موقعك (في إطار هجمة تصيد احتيالي مثلاً)، قد يلزمك التفكير في أية مسؤوليات تجارية أو تشريعية أو قانونية قبل بدء عملية تنظيف موقعك أو حذف أي ملفات. وفي حالات التصيّد الاحتيالي، يحتوي <a href="https://antiphishing.org">antiphishing.org</a> على مصادر مفيدة مثل المستند <a href="https://docs.apwg.org/reports/APWG_WTD_HackedWebsite.pdf">ما يلزمك فعله إذا تم اختراق موقعك بواسطة مستخدمي التصيّد الاحتيالي</a>.</p>

<h4>2- محاولة تسريع إزالة عناوين URL الجديدة التي أنشأها الهاكر</h4>

<p>فإذا كان المخترق قد أنشأ عناوين URL جديدة تمامًا ومرئية للمستخدم، يمكنك طلب إزالة هذه الصفحات بسرعة أكبر من نتائج بحث Google باستخدام ميزة <a href="https://www.google.com/webmasters/tools/removals">إزالة عناوين URL</a> في Search Console. وتعد هذه الخطوة اختيارية تمامًا. إذا حذفت الصفحات وهيأت الخادم على عرض <a href="https://www.support.google.com/webmasters/answer/40132">شفرة حالة 404</a>، سيتم إسقاط الصفحات من فهرس Google بشكل طبيعي بمرور الوقت.</p>

<ul>
  <li>ويعتمد قرار استخدام "إزالة عناوين URL" غالبًا على عدد الصفحات الجديدة غير المرغوب فيها التي تم إنشاؤها (لأن العدد الكبير من الصفحات قد يصعب تضمينه في "إزالة عناوين URL")، كما يعتمد على الأضرار المتوقعة التي قد تتسبب فيها هذه الصفحات للمستخدمين. وحتى تتجنب ظهور الصفحات التي يتم إرسالها عبر "إزالة عناوين URL" ضمن نتائج البحث، تأكد من أنه تمت تهيئة الصفحات بحيث تعرض الاستجابة 404 لم يتم العثور على الملف لعناوين URL غير المرغوب فيها/التي تمت إزالتها.</li>
  <li>ولا تستخدم هذه الأداة لطلب إزالة أية صفحات كانت جيدة سابقًا والتي تم إتلافها فقط بواسطة المخترق؛ فستحتاج إلى ظهورها ضمن نتائج البحث بمجرد أن يتم تنظيفها.
    <em>ولذلك تجدر الإشارة إلى أن "إزالة عناوين URL" لا تستخدم إلا مع الصفحات التي لا ترغب في ظهورها أبدًا في النتائج.</em></li>
</ul>

<h4>3- محاولة تسريع معالجة Google للصفحات النظيفة</h4>

<p>إذا كانت لديك صفحات نظيفة جديدة أو تم تحديثها، يمكنك استخدام ميزة <a href="https://www.support.google.com/webmasters/answer/1352276">الجلب مثل Google</a> في Search Console لإرسال هذه الصفحات إلى فهرس Google. ويعد هذا الأمر اختياريًا تمامًا؛ فعند تخطي هذه الخطوة، من المرجح أن يتم الزحف إلى الصفحات الجديدة أو المعدلة وأن تتم معالجتها بمرور الوقت.</p>

<h4>4- بدء تنظيف الخادم (الخوادم)</h4>

<p>الآن، حان وقت تنظيف موقعك بالاستناد إلى الملاحظات التي تم تدوينها أثناء <a href="hacked_with_spam">تقييم الضرر</a> و<a href="vulnerability">تحديد الثغرة الأمنية</a>. ويعتمد المسار التالي الذي ستسير فيه خلال هذه الخطوة على نوع النسخة الاحتياطية المتوفرة لديك.</p>

<ul>
  <li>نسخة احتياطية نظيفة وحديثة</li>
  <li>نسخة احتياطية نظيفة ولكنها قديمة</li>
  <li>عدم توفر نسخة احتياطية   </li>
</ul>

<p>أولاً، تحقق من أنه تم إنشاء النسخة الاحتياطية هذه <strong>قبل</strong> تعرض موقعك للاختراق.</p>

<ul>
  <li><strong>نسخة احتياطية نظيفة وحديثة</strong>

    <ol>
      <li>نفِّذ استرداد النسخة الاحتياطية.</li>
      <li>ثبِّت أية ترقيات برامج أو تحديثات أو تصحيحات متوفرة. ويتضمن هذا برامج نظام التشغيل إذا كنت تتحكم في الخادم، وجميع التطبيقات، مثل نظام إدارة المحتوى، ووسيط عرض إعلانات التجارة الإلكترونية، والمكونات الإضافية، والنماذج، وما إلى ذلك.</li>
      <li>فكر في ما إذا كان بإمكانك التخلص من برامج الخادم (مثل الأدوات أو المكونات الإضافية أو التطبيقات) التي لم يعد الموقع يستخدمها.</li>
      <li>صحح الثغرة الأمنية.</li>
      <li>تأكد من أنه تمت معالجة جميع المشكلات التي تم العثور عليها أثناء <a href="hacked_with_spam">تقييم الضرر</a>.</li>
      <li>غيِّر كلمات المرور مرة أخرى لجميع الحسابات ذات الصلة بالموقع (مثل بيانات تسجيل الدخول إلى بروتوكول نقل الملفات والدخول إلى قاعدة البيانات وحسابات مشرفي النظام ونظام إدارة المحتوى). وفي الأنظمة التي تعمل بـ Unix:
        <pre>
$passwd admin1</pre>
      </li>
    </ol>
  </li>
  <li><strong>نسخة احتياطية نظيفة ولكنها قديمة</strong>
    <ol>
      <li>احتفظ بصورة على قرص من موقعك الحالي بالرغم من أنه لا يزال مصابًا. فهذه الصورة مجرد احتياط أمني. ضع علامة على النسخة تشير إلى أنها مصابة لتمييزها عن النسخ الأخرى. وبالنسبة إلى النظام الذي يعمل بـ Unix، يمكن أن يكون الاحتفاظ بنسخة على قرص كالتالي:
        <pre>
$dd if=/dev/sda bs=1024 conv=noerror,sync | gzip -c -9
  &gt; /mirror/full-backup-20120125-infected.gz</pre>
      </li>
      <li>احتفظ بنسخة نظام ملفات احتياطية من الخادم تضم الصور وملفات الوسائط. وإذا كانت لديك قاعدة بيانات، فاحتفظ بنسخة احتياطية من قاعدة البيانات أيضًا.
        <pre>
$tar -pczf full-backup-20120125-infected.tar.gz www/ $ mysqldump -u root
  -p --all-databases | gzip -9 &gt; fulldb_backup-20120125-infected.sql</pre>
      </li>
      <li>استرد النسخة الاحتياطية النظيفة ولكنها قديمة على الخادم.</li>
      <li>فكر في ما إذا كان بإمكانك التخلص من برامج الخادم (مثل الأدوات أو المكونات الإضافية أو التطبيقات) التي لم يعد الموقع يستخدمها.</li>
      <li>نفِّذ ترقية لجميع البرامج، بما في ذلك نظام التشغيل إذا كنت تتحكم في الخادم، وجميع التطبيقات البرمجية، مثل نظام إدارة المحتوى، ووسيط عرض إعلانات التجارة الإلكترونية، والمكونات الإضافية، والنماذج، وما إلى ذلك. تأكد من فحص تحديثات الأمان والتصحيحات المتوفرة وتثبيتها.</li>
      <li>صحح الثغرة الأمنية.</li>
      <li>أجري مقارنة <code>diff</code> بين النسخة الاحتياطية النظيفة والنسخة الحديثة المصابة على الموقع سواء أكان التنفيذ يدويًا أو آليًا.
        <pre>
$diff -qr www/ backups/full-backup-20120124/</pre>
      </li>
      <li>حمِّل أي محتوى نظيف وجديد تريد الاحتفاظ به من النسخة المصابة على الخادم الذي تمت ترقيته.
        <pre>
$rsync -avz /backups/full-backup-20120124/www/clean-file.jpg /www/</pre>
      </li>
      <li>تأكد من تصحيح كل عنوان URL مدرج من <a href="hacked_with_spam">تقييم الضرر</a>.</li>
      <li>غيِّر كلمات المرور مرة أخرى لجميع الحسابات ذات الصلة بالموقع (مثل بيانات تسجيل الدخول إلى بروتوكول نقل الملفات والدخول إلى قاعدة البيانات وحسابات مشرفي النظام ونظام إدارة المحتوى). وفي الأنظمة التي تعمل بـ Unix:
        <pre>
$passwd admin1</pre>
      </li>
    </ol>
  </li>
  <li><strong>عدم توفر نسخة احتياطية</strong>
    <ol>
      <li>احتفظ بنسختين احتياطيتين من موقعك على الرغم من أنه لا يزال مصابًا. ذلك أن الاحتفاظ بنسخة احتياطية إضافية سيساعدك في استرداد المحتوى الذي يتم حذفه بدون قصد، كما أنه يتيح لك العودة إلى النسخة السابقة والمحاولة مرة أخرى إذا حدث خطأ ما. صنِّف كل نسخة احتياطية باستخدام العلامة "مصابة" للرجوع إليها في المستقبل.
        <ul>
          <li>ستتم الاستعانة بإحدى النسختين الاحتياطيتين باعتبارها صورة على القرص أو "نسخة طبق الأصل" من الموقع. ويبسط هذا التنسيق استعادة المحتوى. ويمكنك ترك نسخة القرص جانبًا للاستعانة بها عند الضرورة. وبالنسبة إلى النظام الذي يعمل بـ Unix، يمكن أن يكون الاحتفاظ بنسخة على قرص كالتالي:
            <pre>
$dd if=/dev/sda bs=1024 conv=noerror,sync | gzip -c -9 &gt;
  /mirror/full-backup-20120125-infected.gz</pre>
          </li>
          <li>سيتم الاستعانة بالنسخة الأخرى باعتبارها نسخة نظام ملفات من الخادم تتضمن الصور وملفات الوسائط. وإذا كانت لديك قاعدة بيانات، احتفظ بنسخة احتياطية من قاعدة البيانات أيضًا.
            <pre>
$tar -pczf full-backup-20120125-infected.tar.gz www/</pre>
             

            <pre>
$mysqldump -u root -p --all-databases | gzip -9 &gt; fulldb_backup-20120125-infected.sql</pre>
          </li>
          <li>وإذا لم تكن لديك نسخة على قرص، احتفظ بنسختين احتياطيتين من قاعدة البيانات ونسختين احتياطيتين من نظام الملفات.</li>
        </ul>
      </li>
      <li>نظِّف محتوى الموقع على نسخة نظام الملفات الاحتياطية الجديدة (وليس الخادم نفسه)
        <ol>
          <li>إذا أسفر التحقيق السابق عن وجود أذونات تتضمن قدرًا كبيرًا من التساهل، انتقل إليها وصححها. وتأكد من إجراء ذلك على النسخة الاحتياطية وليس على الخادم نفسه.</li>
          <li>وكذلك على النسخة الاحتياطية، نظِّف جميع الملفات المناظرة لعناوين URL التي تم اكتشافها على أنها مخترقة في <a href="hacked_with_spam">تقييم الضرر</a>. وقد تكون هذه الملفات ملفات تهيئة الخادم أو جافا سكريبت أو HTML أو PHP.</li>
          <li>تأكد كذلك من إزالة (عرض استجابة 404) بالنسبة إلى الملفات الجديدة التي أنشأها المخترق (والتي ربما تكون أرسلتها باستخدام أداة إزالة عناوين URL في Search Console أو لم ترسلها).</li>
          <li>صحح الثغرة الأمنية إذا كانت موجودة في الشفرة أو كلمات المرور المخترقة. وقد تساعدك مكتبات التحقق من الإدخال أو سجلات الأمان في التنفيذ.</li>
          <li>إذا كان موقعك يتضمن قاعدة بيانات، ابدأ بتنظيف السجلات التي عدلها المخترق في النسخة الاحتياطية.
            وقبل أن تقرر بأنك قد انتهيت، نفِّذ فحصًا لمدى السلامة على أحد السجلات للتأكد من أنه يبدو نظيفًا.</li>
          <li>غيِّر كلمات المرور مرة أخرى لجميع الحسابات ذات الصلة بالموقع (مثل بيانات تسجيل الدخول إلى بروتوكول نقل الملفات والدخول إلى قاعدة البيانات وحسابات مشرفي النظام ونظام إدارة المحتوى). وفي الأنظمة التي تعمل بـ Unix:
            <pre>
$passwd admin1</pre>
          </li>
          <li>في هذه المرحلة، يجب أن تتضمن النسخة الاحتياطية من موقعك التي سبق أن كانت مصابة بيانات نظيفة فقط. احتفظ بهذه النسخة النظيفة جانبًا، ثم انتقل إلى الإجراء الخامس.</li>
        </ol>
      </li>
    </ol>
  </li>
</ul>

<h4>5- التخلص من البرامج غير الضرورية</h4>

<p>فكر في ما إذا كان بإمكانك التخلص من برامج الخادم (مثل الأدوات أو المكونات الإضافية أو التطبيقات) التي لم يعد الموقع يستخدمها. ويساعد هذا في زيادة مستوى الأمان وفي تبسيط الصيانة المستقبلية.</p>

<h4>6- تنظيف جميع الخوادم</h4>

<ol>
  <li>نفِّذ تثبيتًا نظيفًا، وليس مجرد ترقية. فالترقيات قد تترك ملفات من النسخة السابقة. وإذا ظل هناك ملف مصاب على الخادم، فهناك احتمال كبير أن يتمكن المخترق من الاختراق مجددًا.
    <ul>
      <li>يجب أن يتضمن التثبيت الجديد نظام التشغيل إذا كنت تتحكم في الخادم، وجميع التطبيقات البرمجية، مثل نظام إدارة المحتوى، ووسيط عرض إعلانات التجارة الإلكترونية، والمكونات الإضافية، والنماذج، وما إلى ذلك. تأكد من فحص تحديثات الأمان والتصحيحات المتوفرة.</li>
    </ul>
  </li>
  <li>انقل المحتوى الجيد من نسخة نظام الملفات الاحتياطية النظيفة إلى الخادم (الخوادم) المثبت حديثًا،
    وحمِّل/استرد الملفات/قاعدة البيانات المعروفة والنظيفة فقط. تأكد من صيانة أذونات الملفات المناسبة ولا تستبدل ملفات النظام المثبتة حديثًا.</li>
  <li>غيِّر كلمات المرور للمرة الأخيرة لجميع الحسابات ذات الصلة بالموقع (مثل بيانات تسجيل الدخول إلى بروتوكول نقل الملفات والدخول إلى قاعدة البيانات وحسابات مشرفي النظام ونظام إدارة المحتوى). وفي الأنظمة التي تعمل بـ Unix:
    <pre>
$passwd admin1</pre>
  </li>
</ol>

<h4>7- إعداد خطة صيانة طويلة المدى</h4>

<p>هناك العديد من المصادر التعليمية على الويب التي تقدم صيانة قوية للموقع، مثل <a href="https://www.stopbadware.org/prevent-badware-basics">حجب البرامج الضارة: الأساسيات</a> المقدم من StopBadware. كما نوصي بأهمية تنفيذ ما يلي:</p>

<ul>
  <li>احتفظ بنسخ احتياطية تلقائية ودورية من موقعك.</li>
  <li>توخ الحذر باستمرار بشأن تحديثات البرامج.</li>
  <li>حاول استيعاب ممارسات الأمان على جميع التطبيقات والمكونات الإضافية وبرامج الجهات الخارجية، وما إلى ذلك، قبل تثبيتها على الخادم. قد تؤثر الثغرة الأمنية داخل تطبيق برمجي معين في أمان الموقع بالكامل.</li>
  <li>افرض على المستخدمين سياسة لإنشاء كلمات مرور قوية.</li>
  <li>حافظ على أمان جميع الأجهزة المستخدمة لتسجيل الدخول إلى النظام (من خلال تحديث نظام التشغيل والمتصفح).</li>
</ul>

<h4>8- التحقق جيدًا من اكتمال عملية التنظيف</h4>

<p>تأكد من أنه يمكنك الإجابة بـ "نعم" على الأسئلة التالية:</p>

<ul>
  <li>هل اتبعت الخطوات المناسبة إذا كان المخترق قد حصل على المعلومات الشخصية للمستخدمين؟ </li>
  <li>هل يعمل موقعي بأحدث نسخة من البرامج وأكثرها أمانًا؟ </li>
  <li>هل أزلت جميع التطبيقات أو المكوِّنات الإضافية غير الضرورية وغير المستخدمة التي قد تجعل موقعي عرضة للخطر في المستقبل؟ </li>
  <li>هل استرددت المحتوى وتخلصت من محتوى المخترق؟ </li>
  <li>هل أصلحت نقطة الضعف التي تمثل السبب الرئيسي الذي سمح بالاستيلاء على موقعي؟ </li>
  <li>هل لدي خطة للحفاظ على أمان موقعي؟</li>
</ul>

<h4>9- رد الموقع مرة أخرى على الإنترنت</h4>
<h2>الخطوة التالية</h2>
<p>لقد أنهيت كل شيء تقريبًا. الخطوة الأخيرة في العملية هي <a href="request_review">طلب إجراء مراجعة</a>.</p>

</body></html>
