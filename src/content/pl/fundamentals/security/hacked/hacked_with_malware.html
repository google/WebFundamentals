<html devsite><head>
  <title>Atak ze złośliwym oprogramowaniem</title>
  <meta name="project_path" value="/web/fundamentals/_project.yaml"/>
  <meta name="book_path" value="/web/fundamentals/_book.yaml"/>
</head>
  <body>
<p>Ten etap dotyczy witryn wykorzystywanych przez hakerów do rozpowszechniania złośliwego oprogramowania. Często informuje o tym ostrzeżenie „<em>Ta witryna może wyrządzić szkody na Twoim komputerze</em>” widoczne w wynikach wyszukiwania. To jeden z najdłuższych etapów procesu odzyskiwania.  W jego trakcie utworzysz listę uszkodzonych plików w witrynie.
  Użyjesz jej na późniejszym etapie – <a href="clean_site">Oczyść i zabezpiecz witrynę</a>.</p>
  <p>Jeśli witryna zamiast złośliwego oprogramowania zawiera spam, o czym w wynikach wyszukiwania informuje ostrzeżenie „<em>Ta witryna mogła paść ofiarą ataku hakerów</em>”, przeczytaj artykuł <a href="hacked_with_spam">Oceń szkody (atak ze spamem)</a>.</p>

    <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="Snt45fZQIiU" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<h3>Czego potrzebujesz:</h3>
<ul>
  <li>dostępu administratora do powłoki lub terminala serwerów witryny: internetowego, bazy danych i plików;</li>
  <li>znajomości poleceń powłoki lub terminala;</li>
  <li>możliwości uruchamiania zapytań SQL w bazie danych.</li>
</ul>
<h3>Co musisz zrobić:</h3>

<div class="action">
<p>Etap dzieli się na trzy części:</p>
<ul>
  <li><a href="#preparation">Przygotowania</a></li>
  <li><a href="#investigation">Badanie określonych typów infekcji złośliwym oprogramowaniem</a></li>
  <li><a href="#assessment">Ogólna ocena szkód w systemie plików</a></li>
</ul>
</div>

<a name="preparation"></a>
<h3>Przygotowania</h3>
<ol>
  <li>Unikaj otwierania stron witryny w przeglądarce. Złośliwe oprogramowanie często się rozpowszechnia, wykorzystując luki w zabezpieczeniach przeglądarki, dlatego otwarcie zainfekowanej nim strony może spowodować szkody na Twoim komputerze.</li>
  <li>Utwórz dokument, w którym będziesz zapisywać informacje uzyskane na tym etapie. Te informacje to (przynajmniej) nazwa i lokalizacja każdego naruszonego pliku oraz opis, jak został on zainfekowany. Dokument będzie potrzebny na etapie – <a href="clean_site">Oczyść i zabezpiecz witrynę</a>.</li>
  <li>W razie potrzeby zapoznaj się z materiałami dodatkowymi:
    <ul>
      <li>Obejrzyj film powyżej, by dowiedzieć się, jak działa złośliwe oprogramowanie i jak zabezpieczyć się podczas badania zaatakowanej witryny.</li>
      <li>Na <a href="/safe-browsing/">stronie diagnostycznej w Bezpiecznym przeglądaniu Google</a> znajdziesz informacje o tym, czy witryna może być niebezpieczna dla użytkowników. Opis stanu witryny jest dostępny pod adresem URL podobnym do tego:
      <pre>http://www.google.com/safebrowsing/diagnostic?site=&lt;your-site&gt;</pre>
      Na przykład:
      <code>http://www.google.com/safebrowsing/diagnostic?site=webmastercentralblog.blogspot.com</code></li>
    </ul>
  </li>
  <li>Użyj narzędzia <a href="https://www.google.com/search?q=cURL">cURL</a> lub <a href="https://www.google.com/search?q=Wget">Wget</a>, by wysłać żądania HTTP (gdy zechcesz np. przejrzeć treść strony).
    <p>Te bezpłatne narzędzia pozwalają dołączyć do żądań informacje o stronie odsyłającej i kliencie użytkownika, co ułatwia diagnostykę przekierowań. Podanie konkretnej strony odsyłającej lub klienta użytkownika pomaga zasymulować okoliczności oczekiwane przez hakerów, którzy mogą skonfigurować wyświetlanie złośliwych treści tylko użytkownikom z określonym klientem lub stroną odsyłającą, tak by skierować je do bardziej „przeciętnych” osób oraz uniknąć wykrycia przez właścicieli witryn i skanery złośliwego oprogramowania.</p>
    <pre>$curl -v --referer "http://www.google.com" &lt;your-url&gt;</pre></li>
</ol>

<a name="investigation"></a>
<h3>Badanie określonych typów infekcji złośliwym oprogramowaniem w witrynie</h3>
<ol>
  <li>Wybierz zweryfikowaną witrynę w Search Console, a potem kliknij <strong>Problemy dotyczące bezpieczeństwa</strong>.</li>
  <li> Na stronie „Problemy dotyczące bezpieczeństwa” skontroluj wszystkie kategorie złośliwego oprogramowania w witrynie (np. Konfiguracja serwera czy Wstrzyknięty SQL). Aby uzyskać dodatkowe informacje o zainfekowanych adresach URL z wybranej kategorii, kliknij „Pokaż szczegóły”. Szczegóły mogą zawierać przykładowe fragmenty kodu wstrzykniętego przez hakera. Z każdej kategorii skopiuj do dokumentu z wynikami kontroli następujące dane:
    <ul>
      <li>wszystkie przykładowe zainfekowane adresy URL, które znajdziesz na stronie „Problemy dotyczące bezpieczeństwa”, w sekcji poświęconej złośliwemu oprogramowaniu;</li>
      <li>adresy wszystkich pozostałych stron, na których podczas kontroli wykryjesz szkody;</li>
      <li>szczegółowe informacje o zainfekowanych stronach, np. rodzaj wyrządzonych szkód.</li>
    </ul>
  </li>
  <li>Poniżej znajdziesz informacje, które ułatwią Ci kontrolę każdego typu złośliwego oprogramowania:
    <ul>
      <li><a href="https://www.support.google.com/webmasters/answer/3024318">Konfiguracja serwera</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024309">Wstrzyknięty SQL</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024381">Szablon błędu</a></li>
      <li><a href="https://www.support.google.com/webmasters/answer/3024344">Wstrzyknięty kod</a></li>
    </ul>
  </li>
</ol>

<a name="assessment"></a>
<h4>Ocena szkód w systemie plików</h4>
        <div class="video-wrapper">
      <iframe class="devsite-embedded-youtube-video" data-video-id="2A4dLkXXUjo" data-autohide="1" data-showinfo="0" frameborder="0" allowfullscreen>
      </iframe>
    </div>

<p>Teraz musisz zalogować się do systemu plików witryny, by przeprowadzić dokładniejszą kontrolę. Pamiętaj, że haker mógł między innymi zmienić istniejące strony lub rekordy w bazie danych, utworzyć zupełnie nowe strony ze spamem, dopisać funkcje wyświetlania spamu na nienaruszonych stronach oraz zostawić sobie „furtki”, które (jeśli nie zostaną usunięte) pozwolą mu znowu dostać się do systemu witryny i dalej prowadzić złośliwe działania.</p>
<p>Jeśli witryna jest online, przed wykonaniem tego punktu możesz przełączyć ją w tryb offline.</p>
<ol>
  <li>Jeśli masz nienaruszoną kopię zapasową witryny, ustal, które pliki zostały utworzone lub zmienione od czasu wykonania tej kopii. Dodaj je do swojej listy, bo warto je dokładnie zbadać. W systemie typu Unix możesz użyć tego polecenia:
  <pre>$ diff -qr &lt;current-directory&gt; &lt;backup-directory&gt;</pre>
  Na przykład:
  <pre>$ diff -qr www/ backups/full-backup-20120124/</pre>
  oraz
  <pre>$ md5sum &lt;current-page&gt; &lt;backup-page&gt;</pre>
  Na przykład:
  <pre>$ md5sum www/page.html backups/full-backup-20120124/page.html</pre></li>
  <li>W <strong>dziennikach serwera, dostępu i błędów</strong> poszukaj podejrzanej aktywności, np. nieudanych prób logowania, nietypowych poleceń w historii (szczególnie na koncie root), tworzenia nieznanych kont użytkowników itd. Pamiętaj, że haker mógł zmienić te dzienniki, by zatrzeć po sobie ślady. W razie potrzeby kilka pomocnych przykładów możesz zobaczyć w filmie do etapu <a href="vulnerability">Znajdź lukę w zabezpieczeniach</a>.</li>
  <li>Poszukaj przekierowań w <strong>plikach konfiguracyjnych</strong>, takich jak .htaccess i httpd.conf.
    Hakerzy często tworzą warunkowe przekierowania uzależnione od klienta użytkownika, pory dnia lub strony odsyłającej.</li>
  <li>Poszukaj zbyt szerokich uprawnień do folderów i plików. Hakerzy manipulują uprawnieniami, bo jeśli właściciel witryny nie wykryje zmienionych uprawnień, będą mogli znowu dostać się do systemu witryny. Pliki z uprawnieniami wyższymi niż 644 (rw-r--r--) i foldery z uprawnieniami wyższymi niż 755 (rwxr-xr-x) mogą powodować problemy z bezpieczeństwem. Upewnij się, że takie uprawnienia faktycznie są potrzebne. W systemie typu Unix użyj poleceń:
  <pre>$ find &lt;your-dir&gt; -type d -not -perm 755 -exec ls -ld {} \;</pre>
  <pre>$ find &lt;your-dir&gt; -type f -not -perm 644 -exec ls -la {} \;</pre></li>
  <li>Jeśli korzystasz z bazy danych, skontroluj po kolei każdy rekord, używając np. narzędzia <a href="https://www.phpmyadmin.net/home_page/index.php">phpMyAdmin</a>.</li>
</ol>

<h2>Kolejny etap</h2>
<p>Kolejny etap procesu – <a href="vulnerability">Znajdź lukę w zabezpieczeniach</a>.</p>

</body></html>
