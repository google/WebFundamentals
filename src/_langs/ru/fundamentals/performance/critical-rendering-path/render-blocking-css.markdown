---
layout: article
title: "Оптимизация CSS"
description: "Когда браузер находит в документе ссылку на CSS-файл, он приостанавливает процесс визуализации и начинает формировать модель CSSOM. Чтобы ускорить процесс, упрощайте CSS и используйте медиазапросы. Также убедитесь, что браузер может быстро скачать CSS-файлы."
introduction: "Когда браузер находит в документе ссылку на CSS-файл, он приостанавливает процесс визуализации и начинает формировать модель CSSOM. Чтобы ускорить процесс, упрощайте CSS и используйте медиазапросы. Также убедитесь, что браузер может быстро скачать CSS-файлы."
article:
  written_on: 2014-04-01
  updated_on: 2014-09-18
  order: 3
collection: critical-rendering-path
authors:
  - ilyagrigorik
related-guides:
  media-queries:
    -
      title: Улучшение отзывчивости с помощью медиазапросов CSS
      href: fundamentals/layouts/rwd-fundamentals/use-media-queries
      section:
        title: "Отзывчивый веб-дизайн"
        href: fundamentals/layouts/rwd-fundamentals/use-media-queries
key-takeaways:
  render-blocking-css:
    - По умолчанию при обработке CSS визуализация страницы блокируется.
    - С помощью медиазапросов обработку некоторых CSS-файлов можно отложить.
    - Браузер скачивает все CSS-файлы (как с медиазапросами, так и без них).
---
{% wrap content%}

<style>
  img, video, object {
    max-width: 100%;
  }

  img.center {
    display: block;
    margin-left: auto;
    margin-right: auto;
  }
</style>


Из прошлой статьи мы узнали, что для создания модели визуализации необходимы модели DOM и CSSOM. Поэтому мы можем сделать следующий вывод: **и HTML, и CSS замедляют вывод страницы**. HTML-документ нужно обработать для создания модели DOM, без которой на странице не будет контента. А что дает обработка CSS, можно увидеть на иллюстрации ниже.

{% include modules/takeaway.liquid list=page.key-takeaways.render-blocking-css %}

<div class="clear">
  <div class="g--half">
    <b>"Нью-Йорк таймс" с CSS</b>
    <img class="center" src="images/nytimes-css-device.png" alt="Нью-Йорк таймс с CSS">

  </div>

  <div class="g--half g--last">
    <b>"Нью-Йорк таймс" без CSS</b>
    <img src="images/nytimes-nocss-device.png" alt="Нью-Йорк таймс без CSS">

  </div>
</div>

{% comment %}
<table>
<tr>
<td>"Нью-Йорк таймс" с CSS</td>
<td>"Нью-Йорк таймс" без CSS</td>
</tr>
<tr>
<td><img src="images/nytimes-css-device.png" alt="Нью-Йорк таймс с CSS" class="center"></td>
<td><img src="images/nytimes-nocss-device.png" alt="Нью-Йорк таймс без CSS" class="center"></td>
</tr>
</table>
{% endcomment %}

На иллюстрации изображен сайт газеты `Нью-Йорк таймс` с CSS и без (эффект на скриншоте справа часто называют `появлением нестилизованного контента`). Как видно, пользоваться страницей без CSS почти невозможно. Чтобы избежать такой ситуации, браузер обрабатывает CSS-файл сразу же, как только находит его в HTML-документе. В результате страница выводится на экран только после того, как браузер создаст обе модели: и DOM, и CSSOM. 

> **_Обработка CSS задерживает вывод страницы на экран! Ускорьте процесс визуализации, предоставив браузеру быстрый доступ к CSS-файлу._**

А теперь предположим, что в вашем HTML-документе есть ссылки на несколько CSS-файлов, один из которых содержит стиль для печати страницы, а второй - для ее просмотра на большом экране. Поскольку эти стили используются только при определенных условиях, вы можете сообщить об этом браузеру и предотвратить задержку при загрузке страницы.

Для этого добавьте в код медиазапрос:

{% highlight html %}
<link href="style.css" rel="stylesheet">
<link href="print.css" rel="stylesheet" media="print">
<link href="other.css" rel="stylesheet" media="(min-width: 40em)">
{% endhighlight %}

В [медиазапросе]({{site.fundamentals}}/layouts/rwd-fundamentals/use-media-queries.html) указывается тип устройства и, если необходимо, условия запроса. Рассмотрим приведенный выше пример кода. Первому CSS-файлу не присвоен тип устройства, поэтому он будет применяться по умолчанию и, соответственно, задерживать вывод страницы. Второй файл применяется при печати - возможно, с его помощью упрощается макет страницы, меняется шрифт и т. д. На это указывает медиазапрос `print`, который сообщит браузеру, что данный CSS-файл обрабатывать сразу не нужно. И, наконец, ссылка на третий файл содержит медиазапрос с условием. Только в том случае, если это условие будет выполнено, браузер скачает CSS-файл и приостановит вывод страницы.

Медиазапросы позволяют адаптировать страницу под определенное устройство, например монитор или принтер, и изменять стиль в зависимости от ориентации экрана, его размера и других подобных факторов. **Ссылаясь на CSS-файлы, обязательно учитывайте их предназначение! Используйте медиазапросы, чтобы сократить время вывода страницы на экран.**

{% include modules/related_guides.liquid inline=true list=page.related-guides.media-queries %}

Давайте разберем следующий пример:

{% highlight html %}
<link href="style.css"    rel="stylesheet">
<link href="style.css"    rel="stylesheet" media="screen">
<link href="portrait.css" rel="stylesheet" media="orientation:portrait">
<link href="print.css"    rel="stylesheet" media="print">
{% endhighlight %}

* Первый CSS-файл заблокирует вывод страницы, так как его необходимо обработать.
* Несмотря на медиазапрос, CSS-файл во второй строке также заблокирует вывод страницы. Дело в типе устройства `screen` - браузер присваивает это значение по умолчанию всем CSS-файлам без медиазапроса. Поэтому вторая ссылка в примере эквивалентна первой.
* Третья ссылка содержит медиазапрос с условием, которое будет проверено при загрузке страницы. При портретной ориентации устройства браузер заблокирует вывод страницы и начнет обработку CSS; при альбомной ориентации браузер продолжит создание DOM.
* Четвертый CSS-файл используется только для печати, поэтому браузер не будет блокировать вывод страницы.

Учтите, что под блокировкой подразумевается только приостановка вывода страницы. При этом браузер скачивает все CSS-файлы независимо от того, блокируют они вывод или нет. Приотритет скачивания выше у тех файлов, без которых вывод страницы невозможен.

{% include modules/nextarticle.liquid %}

{% endwrap%}

